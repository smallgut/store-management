<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>首頁</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="common.js"></script>
</head>

<body class="bg-gray-100 p-4 transition-opacity duration-700 ease-in-out opacity-0">
  <!-- 🔹 導航列 -->
  <nav class="bg-blue-500 p-4 text-white flex justify-between items-center">
    <ul class="flex space-x-4">
      <li><a href="index_zh.html">首頁</a></li>
      <li><a href="login_zh.html">登入</a></li>
      <li data-role="admin,manager"><a href="analytics_zh.html">分析</a></li>
      <li data-role="admin,manager"><a href="products_zh.html">管理產品</a></li>
      <li data-role="admin,manager"><a href="vendors_zh.html">管理供應商</a></li>
      <li><a href="customer-sales_zh.html">記錄顧客銷售</a></li>
      <li><a href="vendor-loan-record_zh.html">供應商借貨記錄</a></li>
      <li><a href="product-catalog_zh.html">產品目錄</a></li>
      
    </ul>
    <li><a href="index.html">English</a></li>
    <button id="logout-btn" class="bg-red-500 px-3 py-1 rounded hover:bg-red-600">登出</button>
  </nav>

  <!-- 🔹 主要內容 -->
  <h1 class="text-2xl font-bold mb-4 mt-4">首頁</h1>
  <div id="error" class="text-red-500 mb-4 font-bold text-lg"></div>
  <div id="message" class="text-green-500 mb-4 font-bold text-lg"></div>
  <div id="loading" class="text-blue-500 mb-4 hidden">載入中...</div>

  <div class="bg-white p-6 rounded-xl shadow text-gray-700">
    <p class="text-lg">👋 歡迎使用 POS 系統主頁！</p>
    <p class="mt-2">請使用上方的導覽選單以存取各項功能，如「管理產品」、「分析」、「供應商管理」或「顧客銷售記錄」。</p>
  </div>

  <div class="mt-6 bg-white p-4 rounded-xl shadow text-sm text-gray-600">
    <p>📅 今天日期：<span id="today-date"></span></p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      console.log("🏠 初始化首頁...");

      const supabase = await ensureSupabaseClient();

      // 🔒 登入驗證
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        alert("請先登入系統。Please log in to the system first.");
        window.location.href = "login_zh.html";
        return;
      }
const role = await getUserRole();
applyRoleRestrictions(role);
      // 🔑 登出按鈕
      const logoutBtn = document.getElementById("logout-btn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", async () => {
          await supabase.auth.signOut();
          alert("您已成功登出系統。");
          window.location.href = "login_zh.html";
        });
      }

      // ✅ 顯示今日日期
      const today = new Date().toLocaleDateString("zh-TW", {
        year: "numeric",
        month: "long",
        day: "numeric",
        weekday: "long"
      });
      document.getElementById("today-date").textContent = today;

      // ✨ 頁面淡入效果
      setTimeout(() => document.body.style.opacity = 1, 100);
    });
  </script>
</body>
</html>
