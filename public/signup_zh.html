<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>POS ç®¡ç†å“¡è¨»å†Š</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="common.js"></script>
</head>

<body class="bg-gray-100 p-4 transition-opacity duration-700 ease-in-out opacity-0">
  <!-- ğŸ”¹ å°èˆªåˆ— -->
  <nav class="bg-blue-500 p-4 text-white flex justify-between items-center">
    <ul class="flex space-x-4">
      <li><a href="index_zh.html">é¦–é </a></li>
      <li><a href="login_zh.html">ç™»å…¥</a></li>
      <li><a href="analytics_zh.html">åˆ†æ</a></li>
      <li><a href="products_zh.html">ç®¡ç†ç”¢å“</a></li>
      <li><a href="vendors_zh.html">ç®¡ç†ä¾›æ‡‰å•†</a></li>
      <li><a href="customer-sales_zh.html">è¨˜éŒ„é¡§å®¢éŠ·å”®</a></li>
      <li><a href="vendor-loan-record_zh.html">ä¾›æ‡‰å•†å€Ÿè²¨è¨˜éŒ„</a></li>
      <li><a href="product-catalog_zh.html">ç”¢å“ç›®éŒ„</a></li>
      
    </ul>
  </nav>

  <!-- ğŸ”¹ è¨»å†Šè¡¨å–® -->
  <main class="flex-grow flex items-center justify-center">
    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-md">
      <h1 class="text-2xl font-bold mb-4 text-center">å»ºç«‹ç®¡ç†å“¡å¸³è™Ÿ</h1>

      <form id="signup-form" class="space-y-4">
        <div>
          <label for="email" class="block mb-1 font-medium">é›»å­éƒµä»¶</label>
          <input id="email" type="email" required autocomplete="email"
                 class="w-full border p-2 rounded focus:ring focus:ring-blue-200"
                 placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶" />
        </div>

        <div>
          <label for="password" class="block mb-1 font-medium">å¯†ç¢¼</label>
          <input id="password" type="password" required autocomplete="new-password"
                 class="w-full border p-2 rounded focus:ring focus:ring-blue-200"
                 placeholder="è«‹è¼¸å…¥å¯†ç¢¼" />
        </div>

        <div>
          <label for="confirm" class="block mb-1 font-medium">ç¢ºèªå¯†ç¢¼</label>
          <input id="confirm" type="password" required autocomplete="new-password"
                 class="w-full border p-2 rounded focus:ring focus:ring-blue-200"
                 placeholder="å†æ¬¡è¼¸å…¥å¯†ç¢¼" />
        </div>

        <button type="submit"
                class="w-full bg-green-600 hover:bg-green-700 text-white p-2 rounded font-semibold">
          è¨»å†Šå¸³è™Ÿ
        </button>
      </form>

      <p id="error" class="text-red-500 mt-4 text-center"></p>

      <div class="mt-6 text-center text-sm text-gray-600">
        <p>å·²æœ‰å¸³è™Ÿï¼Ÿ<a href="login_zh.html" class="text-blue-600 hover:underline">ç™»å…¥</a></p>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      console.log("ğŸ§© åˆå§‹åŒ–è¨»å†Šé é¢...");
      const supabase = await ensureSupabaseClient();

      // âœ¨ é é¢æ·¡å…¥
      setTimeout(() => document.body.style.opacity = 1, 100);

      // ğŸ§¾ è¨»å†Šè¡¨å–®é‚è¼¯
      const form = document.getElementById("signup-form");
      const errorEl = document.getElementById("error");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;
        const confirm = document.getElementById("confirm").value;

        errorEl.textContent = "";

        if (!email || !password || !confirm) {
          errorEl.textContent = "âš ï¸ è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½ã€‚";
          return;
        }

        if (password !== confirm) {
          errorEl.textContent = "âš ï¸ å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸ä¸€è‡´ã€‚";
          return;
        }

        try {
          const { data, error } = await supabase.auth.signUp({ email, password });

          if (error) {
            console.error("âŒ è¨»å†Šå¤±æ•—ï¼š", error);
            errorEl.textContent = "è¨»å†Šå¤±æ•—ï¼š" + (error.message || "æœªçŸ¥éŒ¯èª¤");
          } else {
            console.log("âœ… ç®¡ç†å“¡å¸³è™Ÿå»ºç«‹æˆåŠŸï¼š", data);
            alert("âœ… è¨»å†ŠæˆåŠŸï¼Œè«‹å‰å¾€ç™»å…¥é é¢ç™»å…¥ã€‚");
            window.location.href = "login_zh.html?signup=success";
          }
        } catch (err) {
          console.error("âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š", err);
          errorEl.textContent = "ç™¼ç”ŸéŒ¯èª¤ï¼š" + err.message;
        }
      });
    });
  </script>
</body>
</html>
