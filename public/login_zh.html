<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>POS ç™»å…¥</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="common.js"></script>
</head>

<body class="bg-gray-100 p-4 transition-opacity duration-700 ease-in-out opacity-0">
  <!-- ğŸ”¹ å°èˆªåˆ— -->
  <nav class="bg-blue-500 p-4 text-white flex justify-between items-center">
    <ul class="flex space-x-4">
      <li><a href="index_zh.html">é¦–é </a></li>
      <li><a href="login_zh.html">ç™»å…¥</a></li>
      <li><a href="analytics_zh.html">åˆ†æ</a></li>
      <li><a href="products_zh.html">ç®¡ç†ç”¢å“</a></li>
      <li><a href="vendors_zh.html">ç®¡ç†ä¾›æ‡‰å•†</a></li>
      <li><a href="customer-sales_zh.html">è¨˜éŒ„é¡§å®¢éŠ·å”®</a></li>
      <li><a href="vendor-loan-record_zh.html">ä¾›æ‡‰å•†å€Ÿè²¨è¨˜éŒ„</a></li>
      <li><a href="product-catalog_zh.html">ç”¢å“ç›®éŒ„</a></li>
      
    </ul>
    <li><a href="login.html">English</a></li>
  </nav>

  <!-- ğŸ”¹ ç™»å…¥è¡¨å–® -->
  <main class="flex-grow flex items-center justify-center">
    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-md">
      <h1 class="text-2xl font-bold mb-4 text-center">POS ç™»å…¥ç³»çµ±</h1>

      <form id="login-form" class="space-y-4">
        <div>
          <label for="email" class="block mb-1 font-medium">é›»å­éƒµä»¶</label>
          <input id="email" type="email" required
                 class="w-full border p-2 rounded focus:ring focus:ring-blue-200"
                 placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶" />
        </div>

        <div>
          <label for="password" class="block mb-1 font-medium">å¯†ç¢¼</label>
          <input id="password" type="password" required
                 class="w-full border p-2 rounded focus:ring focus:ring-blue-200"
                 placeholder="è«‹è¼¸å…¥å¯†ç¢¼" />
        </div>

        <button type="submit"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white p-2 rounded font-semibold">
          ç™»å…¥
        </button>
      </form>

      <p id="success" class="text-green-600 mt-3 text-center hidden"></p>
      <p id="error" class="text-red-500 mt-3 text-center"></p>

      <div class="mt-6 text-center text-sm text-gray-600">
        <p>å°šæœªç™»å…¥çš„è©±è«‹è¼¸å…¥æ­£ç¢ºå¸³è™Ÿå¯†ç¢¼ã€‚</p>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      console.log("ğŸ” åˆå§‹åŒ–ç™»å…¥é é¢...");
      const supabase = await ensureSupabaseClient();

      // âœ¨ é é¢æ·¡å…¥æ•ˆæœ
      setTimeout(() => document.body.style.opacity = 1, 100);

      // âœ… é¡¯ç¤ºè¨»å†ŠæˆåŠŸè¨Šæ¯
      const params = new URLSearchParams(window.location.search);
      if (params.get("signup") === "success") {
        const msg = document.getElementById("success");
        msg.textContent = "âœ… å¸³è™Ÿå»ºç«‹æˆåŠŸï¼Œè«‹ç™»å…¥ã€‚";
        msg.classList.remove("hidden");
      }

      // ğŸ§© ç™»å…¥é‚è¼¯
      const form = document.getElementById("login-form");
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;

        if (!email || !password) {
          alert("è«‹è¼¸å…¥é›»å­éƒµä»¶èˆ‡å¯†ç¢¼ã€‚");
          return;
        }

        const { data, error } = await supabase.auth.signInWithPassword({ email, password });

        if (error) {
          console.error("âŒ ç™»å…¥å¤±æ•—ï¼š", error);
          document.getElementById("error").textContent = "ç™»å…¥å¤±æ•—ï¼Œè«‹ç¢ºèªå¸³è™Ÿæˆ–å¯†ç¢¼æ˜¯å¦æ­£ç¢ºã€‚";
        } else {
          console.log("âœ… ç™»å…¥æˆåŠŸï¼š", data);
          alert("ç™»å…¥æˆåŠŸï¼Œæ­¡è¿ä½¿ç”¨ï¼");
          window.location.href = "index_zh.html";
        }
      });
    });
  </script>
</body>
</html>
