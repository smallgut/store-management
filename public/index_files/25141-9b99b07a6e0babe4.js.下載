!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="db19408b-b7c6-48c5-9e1f-039b2d950c44",e._sentryDebugIdIdentifier="sentry-dbid-db19408b-b7c6-48c5-9e1f-039b2d950c44")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[25141],{4295:(e,t,s)=>{s.d(t,{c:()=>o,f:()=>r});var n=s(88382);function o(){let[e,t]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{let e=()=>{let e=navigator.userAgent||navigator.vendor;t(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e))};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),e}function r(){let e=navigator.userAgent||navigator.vendor;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)}},13103:(e,t,s)=>{s.d(t,{Cf:()=>m,Es:()=>u,L3:()=>h,ZJ:()=>d,c7:()=>p,lG:()=>a,rr:()=>g,zM:()=>l});var n=s(79342),o=s(61312),r=s(53592),i=s(88382);let a=r.bL,l=r.l9,d=r.ZL;r.bm;let c=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,n.jsx)(r.hJ,{ref:t,className:(0,o.cn)("fixed inset-0 z-50 bg-overlay backdrop-blur-[2px] duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...i})});c.displayName=r.hJ.displayName;let m=i.forwardRef((e,t)=>{let{className:s,overlayClassname:i,children:a,...l}=e;return(0,n.jsxs)(d,{children:[(0,n.jsx)(c,{className:i}),(0,n.jsx)(r.UC,{ref:t,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid translate-x-[-50%] translate-y-[-50%] gap-4 bg-background duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%]",s),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},...l,children:a})]})});m.displayName=r.UC.displayName;let p=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...s})};p.displayName="DialogHeader";let u=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s})};u.displayName="DialogFooter";let h=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,n.jsx)(r.hE,{ref:t,className:(0,o.cn)("text-lg font-medium leading-none tracking-tight",s),...i})});h.displayName=r.hE.displayName;let g=i.forwardRef((e,t)=>{let{className:s,...i}=e;return(0,n.jsx)(r.VY,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",s),...i})});g.displayName=r.VY.displayName},23329:(e,t,s)=>{s.d(t,{b:()=>u,w:()=>p});var n=s(33473),o=s(65258),r=s(11492),i=s(23831),a=s(53915),l=s(3814),d=s(43893);let c={promiseById:{},byId:{},list:[],abortControllerById:{}};class m{constructor(e,t){this.set=e,this.get=t,this.promiseById=c.promiseById,this.byId=c.byId,this.list=c.list,this.abortControllerById=c.abortControllerById,this.upsertConversation=(0,o.el)(this.set,"byId","conversationId"),this.appendConversations=(0,o.BC)(this.set,"byId","conversationId"),this.removeConversation=(0,o.TF)(this.set,"byId"),this.setById=(0,o.kp)(this.set,"byId"),this.idsertConversationPromise=(0,o.q5)(this.set,"promiseById"),this.removeConversationPromise=(0,o.TF)(this.set,"promiseById"),this.setPromiseById=(0,o.kp)(this.set,"promiseById"),this.idsertAbortControllerById=(0,o.q5)(this.set,"abortControllerById"),this.removeAbortControllerById=(0,o.TF)(this.set,"abortControllerById"),this.upsertAndCacheConversation=e=>{this.upsertConversation(e),this.idsertConversationPromise(Promise.resolve(e),e.conversationId)},this.fetchCreateConversation=e=>{var t;let s=this.get(),o=d.A3.getState(),i=r.Pt.chatCreateConversation({body:e}).then(e=>({...e,personaId:(0,n._c)(e.systemPromptName),isNew:!0,state:"closed"})),a=null==(t=e.addResponseRequest)?void 0:t.conversationId;return a&&(s.idsertConversationPromise(i,a),o.nodesByConversationId[a]=[]),i.then(e=>{s.upsertConversation(e),s.idsertConversationPromise(i,e.conversationId),o.nodesByConversationId[e.conversationId]=[]}).catch(console.error),i},this.fetchUpdateConversation=(e,t)=>{let s=this.get(),n=r.Pt.chatUpdateConversation({conversationId:e,body:t}).then(e=>({...s.byId[e.conversationId]||{isNew:!1,state:"closed"},...e})).then(i.A(s.upsertConversation));return s.idsertConversationPromise(n,e),n.catch(console.error),n},this.fetchDeleteConversation=e=>{let t=this.get(),s=r.Pt.chatDeleteConversation({conversationId:e});return t.removeConversation(e),t.removeConversationPromise(e),s},this.fetchSoftDeleteConversation=e=>{let t=this.get(),s=r.Pt.chatSoftDeleteConversation({conversationId:e});return t.removeConversation(e),t.removeConversationPromise(e),s},this.fetchGetConversation=e=>{let t=this.get();if(e in t.promiseById)return t.promiseById[e];let s=r.Pt.chatGetConversation({conversationId:e,includeWorkspaces:!0}).then(e=>({...e,personaId:(0,n._c)(e.systemPromptName),isNew:!1,state:"closed"}));return t.set(a.A(l.A(["promiseById",e]),s)),s.then(t.upsertConversation).catch(console.error),s},this.fetchGetManyConversations=e=>{let t=this.get(),s={},o=[];if(e.forEach(e=>{e in t.promiseById?s[e]=t.promiseById[e]:o.push(e)}),0===o.length)return Promise.all(Object.values(s));let i=o.length>0?r.Pt.chatGetConversations({conversationIds:o,includeWorkspaces:!0}).then(e=>{let{conversations:t}=e;return null==t?void 0:t.map(e=>({...e,personaId:(0,n._c)(e.systemPromptName),isNew:!1,state:"closed"}))}):Promise.resolve([]);return i.then(e=>{e.forEach(e=>{let s=Promise.resolve(e);t.idsertConversationPromise(s,e.conversationId)}),t.appendConversations(e)}).catch(console.error),Promise.all([...Object.values(s),i.then(e=>e||[])]).then(e=>e.flat())},this.fetchSoftDeleteAllConversations=()=>(this.setById({}),this.setPromiseById({}),r.Pt.chatSoftDeleteAllConversations())}}let p=(0,o.y$)(m);function u(e){let t=new Date().toISOString();return{title:"",createTime:t,modifyTime:t,starred:!1,temporary:!1,isNew:!0,state:"optimistic",mediaTypes:[],workspaces:[],...e}}(0,o.lB)(p,"byId","list",Object.values)},24994:(e,t,s)=>{s.d(t,{R:()=>l});var n=s(79342);s(88382);var o=s(13103),r=s(34500),i=s(41320),a=s(61312);function l(e){let{open:t,setOpen:s,trigger:l,title:d,description:c,footer:m,children:p,contentClassName:u,blurBackground:h}=e;return!(0,i.Di)()&&t?(0,n.jsxs)(o.lG,{open:t,onOpenChange:s,children:[l&&(0,n.jsx)(o.zM,{asChild:!0,children:l}),(0,n.jsxs)(o.Cf,{className:(0,a.cn)("focus:outline-none rounded-none",u),overlayClassname:(0,a.cn)(h&&"backdrop-blur-lg"),"aria-describedby":void 0,children:[(d||c)&&(0,n.jsxs)(o.c7,{children:[null!=d?d:(0,n.jsx)(o.L3,{children:d}),null!=c?c:(0,n.jsx)(o.rr,{children:c})]}),p]})]}):(0,n.jsxs)(r._s,{open:t,onOpenChange:s,dismissible:!!s,children:[l&&(0,n.jsx)(r.Uz,{asChild:!0,children:l}),(0,n.jsxs)(r.zj,{className:(0,a.cn)("focus:outline-none",u,"max-w-none !rounded-b-none"),overlayClassName:(0,a.cn)(h&&"backdrop-blur-lg"),"aria-describedby":void 0,children:[(d||c)&&(0,n.jsxs)(r.BE,{className:"p-0 text-left",children:[null!=d?d:(0,n.jsx)(r.gk,{children:d}),null!=c?c:(0,n.jsx)(r.I6,{children:c})]}),p,m&&(0,n.jsx)(r.tb,{className:"pt-2",children:m})]})]})}},28245:(e,t,s)=>{s.d(t,{Sf:()=>w,TL:()=>S});var n=s(79342),o=s(56691),r=s(13103),i=s(24994);s(37931);var a=s(61312),l=s(20337),d=s(38541),c=s.n(d),m=s(32171),p=s.n(m),u=s(68332),h=s(44347),g=s(88382),f=s(65146),v=s(4890),y=s(17823),I=s(69648);c().range(1900,new Date().getFullYear()).map(e=>e.toString()).reverse();let w=(0,v.v)()((0,y.Zr)(e=>({stage:"start",setStage:t=>e({stage:t})}),{name:"age-verif"}));function S(e){let{onPass:t}=e,{t:s}=(0,f.Bd)("base"),{stage:d,setStage:c}=w(),{routeToConversation:m}=(0,u.o)(),{client:v}=(0,l.useStatsigClient)(),y=(0,g.useCallback)(()=>{v.logEvent("clicked_signin",void 0,{location:"age-verification"})},[v]),S=(0,g.useCallback)(()=>{c("pass"),null==t||t(),v.logEvent("selected_over_18","pass",{location:"over-18-verification"})},[t,v]),b=(0,g.useCallback)(()=>{c("nopass"),v.logEvent("selected_over_18","nopass",{location:"over-18-verification"})},[v]),C=(0,g.useCallback)(()=>{let{setShowAgeVerification:e}=h.C$.getState();e(!1),m(void 0)},[]);return(0,n.jsxs)(i.R,{open:"pass"!==d,contentClassName:(0,a.cn)("focus:outline-0 focus-within:outline-0 gap-2","bg-background rounded-3xl","w-full md:w-5/6 lg:w-3/5 max-w-sm","flex flex-col","md:overflow-hidden","px-6 py-6"),blurBackground:!0,children:["start"===d&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(r.c7,{className:"mb-4",children:[(0,n.jsx)(r.L3,{className:"mb-1",children:s("Please confirm your age","Please confirm your age")}),(0,n.jsx)(r.rr,{children:s("Please confirm your age.description","In order to continue using Grok we need to confirm your age.")})]}),(0,n.jsxs)("div",{className:"flex items-center justify-center gap-4 p-1",children:[(0,n.jsx)(o.$n,{className:"w-full",variant:"secondary",onClick:b,tabIndex:-1,children:s("I am not over 18","I am not over 18")}),(0,n.jsx)(o.$n,{className:"w-full",variant:"primary",onClick:S,children:s("I am 18 or older","I am 18 or older")})]}),(0,n.jsxs)("div",{className:"relative flex items-center justify-center w-full",children:[(0,n.jsx)(I.w,{className:"absolute -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2"}),(0,n.jsx)("p",{className:"relative px-2 py-1 mx-auto text-xs bg-background text-secondary",children:s("Or","Or")})]}),(0,n.jsx)(o.$n,{asChild:!0,variant:"secondary",size:"lg",onClick:y,children:(0,n.jsx)(p(),{href:"sign-in",children:s("Sign in or create an account","Sign in or create an account")})})]}),"nopass"===d&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(r.c7,{children:[(0,n.jsx)(r.L3,{children:s("Restricted","Restricted")}),(0,n.jsx)(r.rr,{className:"",children:(0,n.jsx)("div",{children:s("Restricted.description","Based on the information you provided you cannot use Grok image generation or 18+ personas.")})})]}),(0,n.jsx)(o.$n,{className:"w-full mt-2",variant:"primary",size:"lg",onClick:C,children:s("Start a new chat","Start a new chat")})]})]})}},29938:(e,t,s)=>{s.d(t,{Uk:()=>c,X4:()=>d,jN:()=>h,yo:()=>g});var n=s(65258),o=s(38541),r=s.n(o),i=s(6132),a=s(11492);let l="custom_personality_id",d={personalityId:l,name:"Custom",prompt:"",description:"Responds to you as you please.",isPreset:!1};function c(e){return!!e&&(e===l||36===e.length)}function m(e){return{name:e.name,content:[{text:e.prompt}]}}function p(e){var t,s;return{personalityId:e.systemPromptId||"",name:e.name||d.name,prompt:(null==(s=e.content)||null==(t=s[0])?void 0:t.text)||"",description:d.description,isPreset:!1}}class u{constructor(e,t){this.set=e,this.get=t,this.promiseById={},this.byId={},this.list=[],this.draftPromptById={},this.upsertPersonality=(0,n.el)(this.set,"byId","personalityId"),this.appendPersonalities=(0,n.BC)(this.set,"byId","personalityId"),this.removePersonality=(0,n.TF)(this.set,"byId"),this.idsertPersonalityPromise=(0,n.q5)(this.set,"promiseById"),this.removePersonalityPromise=(0,n.TF)(this.set,"promiseById"),this.upsertDraftPrompt=(0,n.q5)(this.set,"draftPromptById"),this.fetchCreatePersonality=e=>{let t=this.get(),s=a.eb.systemPromptRepositoryCreateSystemPrompt({body:m(e)}).then(e=>{let t=p(e);return t.description=d.description,t}).then(e=>(t.upsertPersonality(e),t.idsertPersonalityPromise(s,e.personalityId),e));return s},this.fetchUpdatePersonality=e=>{let t=this.get(),s=a.eb.systemPromptRepositoryUpdateSystemPrompt({systemPromptId:e.personalityId,body:m(e)}).then(e=>p(e)).then(e=>(t.upsertPersonality(e),e));return t.idsertPersonalityPromise(s,e.personalityId),s},this.fetchDeletePersonality=e=>(this.get().removePersonality(e.personalityId),a.eb.systemPromptRepositoryDeleteSystemPrompt({systemPromptId:e.personalityId})),this.fetchListPersonalities=()=>{let e=this.get();return a.eb.systemPromptRepositoryListSystemPrompts({body:{pageSize:100}}).then(e=>{var t;return(null==(t=e.assets)?void 0:t.map(p))||[]}).then(t=>(e.appendPersonalities(t),e.set(e=>({promiseById:{...e.promiseById,...r().mapValues(r().keyBy(t,"personalityId"),e=>Promise.resolve(e))}})),t))},this.fetchGetPersonality=e=>{let t=this.get(),s=e.personalityId;if(s in t.promiseById)return t.promiseById[s];let n=a.eb.systemPromptRepositoryGetSystemPrompt({systemPromptId:s}).then(e=>p(e)).then(e=>(t.upsertPersonality(e),t.idsertPersonalityPromise(n,e.personalityId),e));return n}}}let h=(0,n.y$)(u);(0,n.lB)(h,"byId","list",Object.values);let g=i.z.object({personalityId:i.z.string(),name:i.z.string(),prompt:i.z.string(),description:i.z.string(),isPreset:i.z.boolean()});i.z.array(g)},33473:(e,t,s)=>{s.d(t,{_c:()=>C,ru:()=>T,sS:()=>R,v5:()=>w});var n=s(28245),o=s(38541),r=s.n(o),i=s(88382),a=s(65146),l=s(6132);let d=l.z.union([l.z.literal("imageGen"),l.z.literal("search"),l.z.literal("think"),l.z.literal("deepsearch")]),c=l.z.object({personaId:l.z.literal("news"),name:l.z.string(),systemPromptName:l.z.literal("grok3_personality_latest_news"),disclaimer:l.z.string().optional(),disabledTools:d.array()}),m=l.z.object({personaId:l.z.literal("doctor"),name:l.z.string(),systemPromptName:l.z.literal("grok3_personality_medical_advisor"),disclaimer:l.z.string().optional(),disabledTools:d.array()}),p=l.z.object({personaId:l.z.literal("friend"),name:l.z.string(),systemPromptName:l.z.literal("grok3_personality_loyal_friend"),disclaimer:l.z.string().optional(),disabledTools:d.array()}),u=l.z.object({personaId:l.z.literal("tutor"),name:l.z.string(),systemPromptName:l.z.literal("grok3_personality_homework_helper"),disclaimer:l.z.string().optional(),disabledTools:d.array()}),h=l.z.object({personaId:l.z.literal("romance"),name:l.z.string(),systemPromptName:l.z.literal("grok3_personality_romance_me"),disclaimer:l.z.string().optional(),disabledTools:d.array()}),g=l.z.object({personaId:l.z.literal("unhinged"),name:l.z.string(),systemPromptName:l.z.literal("grok3_personality_unhinged_comedian"),disclaimer:l.z.string().optional(),disabledTools:d.array()}),f=l.z.object({personaId:l.z.literal("therapist"),name:l.z.string(),systemPromptName:l.z.literal("grok3_personality_trusted_therapist"),disclaimer:l.z.string().optional(),disabledTools:d.array()}),v=l.z.object({personaId:l.z.literal("scientist"),name:l.z.string(),systemPromptName:l.z.literal("grok3_personality_science_geek"),disclaimer:l.z.string().optional(),disabledTools:d.array()}),y=l.z.object({personaId:l.z.literal("coder"),name:l.z.string(),systemPromptName:l.z.literal("grok3_personality_cracked_coder"),disclaimer:l.z.string().optional(),disabledTools:d.array()}),I=l.z.union([c,m,h,g,p,u,f,v,y]);function w(){let{stage:e}=(0,n.Sf)(),{t}=(0,a.Bd)("base"),s=(0,i.useMemo)(()=>({news:t("persona-name.news","Latest News"),romance:t("persona-name.romance","Companion"),unhinged:t("persona-name.unhinged","Unhinged Comedian"),friend:t("persona-name.friend","Loyal Friend"),tutor:t("persona-name.tutor","Homework Helper"),doctor:t("persona-name.doctor","Not a Doctor"),therapist:t("persona-name.therapist","Not a Therapist"),scientist:t("persona-name.scientist","Scientist"),coder:t("persona-name.coder","Coder")}),[t]),o=(0,i.useMemo)(()=>S.map(e=>({personaId:e,name:s[e],systemPromptName:b[e],disabledTools:[]})).filter(t=>!T.includes(t.personaId)||"nopass"!==e).map(e=>I.safeParse(e)).filter(e=>e.success).map(e=>e.data),[e,s]),l=(0,i.useMemo)(()=>r().keyBy(o,e=>e.personaId),[o]),d=(0,i.useCallback)(e=>{if(!e||!e.personaId||!S.includes(e.personaId))return;let t=l[e.personaId];if(t)return t},[l]);return{personas:o,personaById:l,getPersonaForConversation:d}}let S=["news","romance","unhinged","friend","tutor","doctor","therapist"],b={doctor:"grok3_personality_medical_advisor",news:"grok3_personality_latest_news",friend:"grok3_personality_loyal_friend",tutor:"grok3_personality_homework_helper",romance:"grok3_personality_romance_me",unhinged:"grok3_personality_unhinged_comedian",therapist:"grok3_personality_trusted_therapist",scientist:"grok3_personality_science_geek",coder:"grok3_personality_cracked_coder"};function C(e){if(!e)return;let t=r().invert(b)[e];if(R(t))return t}function R(e){return!!e&&S.includes(e)}let T=["romance","unhinged"]},34500:(e,t,s)=>{s.d(t,{BE:()=>p,I6:()=>g,Uz:()=>l,_s:()=>a,gk:()=>h,tb:()=>u,zj:()=>m});var n=s(79342),o=s(88382),r=s(2512),i=s(61312);let a=e=>{let{shouldScaleBackground:t=!0,...s}=e;return(0,n.jsx)(r._.Root,{shouldScaleBackground:t,...s})};a.displayName="Drawer";let l=r._.Trigger,d=r._.Portal;r._.Close;let c=o.forwardRef((e,t)=>{let{className:s,...o}=e;return(0,n.jsx)(r._.Overlay,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/20 dark:bg-black/80",s),...o})});c.displayName=r._.Overlay.displayName;let m=o.forwardRef((e,t)=>{let{className:s,overlayClassName:o,disableDrag:a,children:l,...m}=e;return(0,n.jsxs)(d,{children:[(0,n.jsx)(c,{className:o}),(0,n.jsxs)(r._.Content,{ref:t,className:(0,i.cn)("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[24px] bg-background-secondary",s),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},...m,children:[a?null:(0,n.jsx)("div",{className:"flex-shrink-0 w-12 h-1 mx-auto mt-3 mb-0 rounded-full bg-secondary/80"}),l]})]})});m.displayName="DrawerContent";let p=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,i.cn)("grid gap-1.5 p-4 text-center sm:text-left",t),...s})};p.displayName="DrawerHeader";let u=e=>{let{className:t,...s}=e;return(0,n.jsx)("div",{className:(0,i.cn)("mt-auto flex flex-col gap-2 p-4",t),...s})};u.displayName="DrawerFooter";let h=o.forwardRef((e,t)=>{let{className:s,...o}=e;return(0,n.jsx)(r._.Title,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",s),...o})});h.displayName=r._.Title.displayName;let g=o.forwardRef((e,t)=>{let{className:s,...o}=e;return(0,n.jsx)(r._.Description,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",s),...o})});g.displayName=r._.Description.displayName},36936:(e,t,s)=>{s.d(t,{V:()=>r});var n=s(65258);class o{constructor(e,t){this.set=e,this.get=t,this.models=[],this.unavailableModels=[],this.defaultAnonModelId="",this.defaultFreeModelId="",this.defaultProModelId="",this.modelById={},this.isPending=!1}}let r=(0,n.y$)(o)},37931:(e,t,s)=>{s.d(t,{bq:()=>c,eb:()=>h,gC:()=>u,l6:()=>l,yv:()=>d});var n=s(79342),o=s(61312),r=s(52970),i=s(10812),a=s(88382);let l=i.bL;i.YJ;let d=i.WT,c=a.forwardRef((e,t)=>{let{className:s,children:a,...l}=e;return(0,n.jsxs)(i.l9,{ref:t,className:(0,o.cn)("group flex h-9 w-full items-center justify-between whitespace-nowrap rounded-lg border border-toggle-border bg-transparent px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus-visible:ring-1 focu-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 [&>svg.chevron-down]:data-[state=open]:rotate-180",s),...l,children:[a,(0,n.jsx)(i.In,{asChild:!0,children:(0,n.jsx)(r.D3D,{className:"w-4 h-4 opacity-50 transition-transform chevron-down"})})]})});c.displayName=i.l9.displayName;let m=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(i.PP,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,n.jsx)(r.Mtm,{className:"w-4 h-4"})})});m.displayName=i.PP.displayName;let p=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,n.jsx)(i.wn,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...a,children:(0,n.jsx)(r.D3D,{className:"w-4 h-4"})})});p.displayName=i.wn.displayName;let u=a.forwardRef((e,t)=>{let{className:s,children:r,position:a="popper",...l}=e;return(0,n.jsx)(i.ZL,{children:(0,n.jsxs)(i.UC,{ref:t,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-xl border border-input-border bg-popover text-popover-foreground shadow-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===a&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:a,...l,children:[(0,n.jsx)(m,{}),(0,n.jsx)(i.LM,{className:(0,o.cn)("p-1","popper"===a&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,n.jsx)(p,{})]})})});u.displayName=i.UC.displayName,a.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)(i.JU,{ref:t,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",s),...r})}).displayName=i.JU.displayName;let h=a.forwardRef((e,t)=>{let{className:s,children:a,...l}=e;return(0,n.jsxs)(i.q7,{ref:t,className:(0,o.cn)("relative flex w-full cursor-pointer select-none items-center rounded-lg py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-card-hover focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,n.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,n.jsx)(i.VF,{children:(0,n.jsx)(r.Srz,{className:"w-4 h-4"})})}),(0,n.jsx)(i.p4,{children:a})]})});h.displayName=i.q7.displayName,a.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,n.jsx)(i.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=i.wv.displayName},41320:(e,t,s)=>{s.d(t,{Di:()=>r,Dy:()=>o,Iu:()=>i});var n=s(88382);let o=768;function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,[t,s]=n.useState(void 0);return n.useEffect(()=>{let t=window.matchMedia("(max-width: ".concat(e-1,"px)")),n=()=>{s(window.innerWidth<e)};return t.addEventListener("change",n),s(window.innerWidth<e),()=>t.removeEventListener("change",n)},[e]),!!t}function i(){let e=r();return{isMobileSize:function(){return e},isTouchDevice:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}}}},43893:(e,t,s)=>{s.d(t,{Jg:()=>k,Ko:()=>A,A3:()=>_});var n=s(8059),o=s(4295),r=s(44845),i=s(48992),a=s(17703),l=s(33960),d=s(65258),c=s(11492),m=s(5129);async function*p(e){if(null===e.body)throw Error("Cannot process response chunks of a response without body.");let t=e.body.getReader(),s=new TextDecoder,n="";for(;;){let{done:e,value:o}=await t.read();if(e)break;let[r,i]=u(n+=s.decode(o,{stream:!0}));for(let e of r)yield e;n=i}let[o,r]=u(n);for(let e of o)yield e;r.length>0&&(yield r)}function u(e){let t=e.split("\n"),s=t.pop();return[t,s]}async function*h(e){for await(let t of p(e)){let s=JSON.parse(t);(0,m.YM)(s,e),yield s}}var g=s(44347),f=s(31643),v=s(99452),y=s.n(v),I=s(38541),w=s.n(I),S=s(81353),b=s(6132),C=s(23329),R=s(56096);let T=b.z.object({memoryReferences:b.z.array(b.z.object({conversationId:b.z.string()})).optional().catch(void 0),deepsearchPreset:b.z.string().optional().catch(void 0),ui_layout:b.z.object({reasoningUiLayout:b.z.enum(["UNIFIED","SPLIT"]).optional().catch(void 0)}).optional().catch(void 0),artifactAction:b.z.enum(["ask","explain"]).optional().catch(void 0),agenticWorkspace:b.z.object({workspaceId:b.z.string()}).optional()}),x={nodesPromisesByConversationId:{},nodesByConversationId:{},initialResponsesPromisesByConversationId:{},loadMoreResponsesPromisesByConversationId:{},previewResponsesPromisesByConversationId:{},byId:{},byConversationId:{},imageIdByUrl:{},inflightPromisesByConversationId:{}};class P{constructor(e,t){var s=this;this.set=e,this.get=t,this.nodesPromisesByConversationId=x.nodesPromisesByConversationId,this.nodesByConversationId=x.nodesByConversationId,this.initialResponsesPromisesByConversationId=x.initialResponsesPromisesByConversationId,this.loadMoreResponsesPromisesByConversationId=x.loadMoreResponsesPromisesByConversationId,this.previewResponsesPromisesByConversationId=x.previewResponsesPromisesByConversationId,this.byId=x.byId,this.byConversationId=x.byConversationId,this.imageIdByUrl=x.imageIdByUrl,this.inflightPromisesByConversationId=x.inflightPromisesByConversationId,this.upsertResponse=(0,d.el)(this.set,"byId","responseId"),this.appendResponses=(0,d.BC)(this.set,"byId","responseId"),this.removeResponse=(0,d.TF)(this.set,"byId"),this.idsertInitialResponsesPromisesByConversationId=(0,d.q5)(this.set,"initialResponsesPromisesByConversationId"),this.removeInitialResponsesPromiseByConversationId=(0,d.TF)(this.set,"initialResponsesPromisesByConversationId"),this.idsertLoadMoreResponsesPromisesByConversationId=(0,d.q5)(this.set,"loadMoreResponsesPromisesByConversationId"),this.removeLoadMoreResponsesPromiseByConversationId=(0,d.TF)(this.set,"loadMoreResponsesPromisesByConversationId"),this.idsertPreviewResponsesPromisesByConversationId=(0,d.q5)(this.set,"previewResponsesPromisesByConversationId"),this.removePreviewResponsesPromiseByConversationId=(0,d.TF)(this.set,"previewResponsesPromisesByConversationId"),this.setOneImageIdByUrl=(0,d.q5)(this.set,"imageIdByUrl"),this.idsertInflightPromisesByConversationId=(0,d.q5)(this.set,"inflightPromisesByConversationId"),this.idsertNodesByConversationId=(0,d.q5)(this.set,"nodesByConversationId"),this.idsertNodesPromisesByConversationId=(0,d.q5)(this.set,"nodesPromisesByConversationId"),this.removeNodesPromise=(0,d.TF)(this.set,"nodesPromisesByConversationId"),this.fetchListResponseNodes=async e=>{let t=this.get();if(t.nodesByConversationId[e])return t.nodesByConversationId[e];if(e in t.nodesPromisesByConversationId)return t.nodesPromisesByConversationId[e];let s=c.Pt.chatListResponseNodes({conversationId:e}).then(e=>{let{responseNodes:t=[]}=e;return t});return t.idsertNodesPromisesByConversationId(s,e),s.then(s=>{t.idsertNodesByConversationId(s,e)}).catch(console.error).finally(()=>{t.removeNodesPromise(e)}),s},this.fetchListInflightResponses=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=s.get();if(!t&&e in n.inflightPromisesByConversationId)return n.inflightPromisesByConversationId[e];let o=c.Pt.chatListResponseNodes({conversationId:e}).then(e=>{let{inflightResponses:t=[]}=e;return t});return n.idsertInflightPromisesByConversationId(o,e),o.then(n.appendResponses).catch(console.error),o},this.loadResponses=async(e,t)=>{let s=this.get(),n=t.filter(e=>!s.byId[e]);if(n.length){var o;let t=((null==(o=await c.Pt.chatLoadResponses({conversationId:e,body:{responseIds:n}}))?void 0:o.responses)||[]).map(t=>{let s=T.optional().parse(t.metadata);return{...t,conversationId:e,memoryReferences:null==s?void 0:s.memoryReferences,deepsearchPreset:null==s?void 0:s.deepsearchPreset}});s.appendResponses(t)}return t.map(e=>this.get().byId[e]).sort((e,t)=>new Date(e.createTime).getTime()-new Date(t.createTime).getTime())},this.loadInitialResponses=async e=>{let t=this.get(),s=t.initialResponsesPromisesByConversationId[e];if(s)return s;let n=t.nodesPromisesByConversationId[e];return n||(n=this.fetchListResponseNodes(e)),s=(async()=>{try{let s=await n;if(!s.length)return[];let o=s[s.length-1],r=(0,i.d7)(o.responseId||"",s,30).filter(e=>!!e.responseId).map(e=>e.responseId);return t.loadResponses(e,r)}catch(e){return console.error(e),[]}})().finally(()=>{t.removeInitialResponsesPromiseByConversationId(e)}),t.idsertInitialResponsesPromisesByConversationId(s,e),s},this.loadMoreResponses=async(e,t)=>{let s=this.get(),n=s.nodesByConversationId[e];if(!n.length)return[];if(e in s.initialResponsesPromisesByConversationId)return s.initialResponsesPromisesByConversationId[e];let o=s.loadMoreResponsesPromisesByConversationId[e];return o||(o=(async()=>{try{let o=s.byConversationId[e]||[],r=(0,i.d7)(t,n),a=(0,i.m$)(r,o),l=r.findIndex(e=>e.responseId===(null==a?void 0:a.responseId)),d=r.slice(l+1,l+30+1).filter(e=>!!e.responseId).map(e=>e.responseId);return s.loadResponses(e,d)}catch(e){return console.error(e),[]}})().finally(()=>{s.removeLoadMoreResponsesPromiseByConversationId(e)}),s.idsertLoadMoreResponsesPromisesByConversationId(o,e)),o},this.loadPreviewResponses=async(e,t)=>{let s=this.get(),n=s.nodesPromisesByConversationId[e];n||(n=this.fetchListResponseNodes(e));let o=s.previewResponsesPromisesByConversationId[e];return o||(o=(async()=>{try{let o=await n,r=(0,i.d7)(o[o.length-1].responseId,o);if(!r.length)return{responses:[],hasOlderResponses:!1,hasNewerResponses:!1};let a=[];if(t&&r.some(e=>e.responseId===t)){let e=r.findIndex(e=>e.responseId===t),s=Math.max(0,e-5);a=r.slice(s,e+5+1).map(e=>e.responseId)}else a=r.slice(0,10).map(e=>e.responseId);let l=r[r.length-1],d=r[0],c=await s.loadResponses(e,a);return{responses:c,hasOlderResponses:!(null==c?void 0:c.some(e=>e.responseId===l.responseId)),hasNewerResponses:!(null==c?void 0:c.some(e=>e.responseId===d.responseId))}}catch(e){return console.error(e),{responses:[],hasOlderResponses:!1,hasNewerResponses:!1}}})().finally(()=>{s.removePreviewResponsesPromiseByConversationId(e)}),s.idsertPreviewResponsesPromisesByConversationId(o,e)),o},this.loadConversationBranch=async(e,t,s)=>{let n=this.get(),o=n.nodesByConversationId[e];if(!o.length)return[];let r=(0,i.d7)(t,o),a=r.slice(0,r.findIndex(e=>e.responseId===s)+1).filter(e=>!!e.responseId).map(e=>e.responseId);return n.loadResponses(e,a)},this.processResponseChunk=e=>{var t,s,n,o;let{currentStreamResponse:r,responseChunk:i,onCitations:a,onHasImage:l,onDisclaimer:d,onFollowUpSuggestedMode:c}=e,m=this.get(),{responseId:p,token:u,modelResponse:h,webSearchResults:g,xSearchResults:f,queryAction:v,cachedImageGenerationResponse:y,followUpSuggestions:I,cardAttachment:S,streamingImageGenerationResponse:b,finalMetadata:C,isThinking:R,messageTag:T,messageStepId:x,bannerMessage:P,disclaimer:M,imageAttachmentInfo:_,progressReport:k,memoryReferences:E,imageDimensions:N,followUpSuggestedMode:B,uiLayout:A}=i;if(p&&r.inflightResponseId!==p&&(r.inflightResponseId=p),v&&(("aurora"===v.type||"flux"===v.type)&&(r.hasImages=!0,l()),"x"===v.type&&(r.hasSearches=!0)),_&&_.imageAttachmentCount&&(r.imageAttachmentCount=_.imageAttachmentCount),N&&(N.height&&(r.generatedImageHeight=N.height),N.width&&(r.generatedImageWidth=N.width)),null==g?void 0:g.results)if(void 0!==x){let e=r.steps[x];e?e.webSearchResults=g.results||[]:r.steps.push({text:[],tags:[],webSearchResults:(null==g?void 0:g.results)||[],xpostIds:[],xposts:[]})}else r.steps.length>0||(r.webSearchResults=g.results||[],a());else if(null==f?void 0:f.results)if(void 0!==x){let e=r.steps[x];e?(e.xposts=f.results||[],e.xpostIds=w().compact(e.xposts.map(e=>e.postId))):r.steps.push({text:[],tags:[],webSearchResults:[],xpostIds:w().compact(f.results.map(e=>e.postId)),xposts:f.results||[]})}else r.steps.length>0||(r.xposts=f.results||[],r.xpostIds=w().compact(r.xposts.map(e=>e.postId)),a());if(y&&y.imageUrl&&(r.generatedImageUrls=r.generatedImageUrls.concat([y.imageUrl])),S&&S.jsonData&&(r.cardAttachmentsJson=r.cardAttachmentsJson.concat([S.jsonData])),E&&(null==(t=E.references)?void 0:t.length)&&(r.memoryReferences=E.references),R&&!r.liveThinkingStartTime&&(r.liveThinkingStartTime=new Date(r.createTime).getTime()),u)if(T&&"UNSET"!==T.toUpperCase()){if(r.searchingStartTime||(r.searchingStartTime=new Date(r.createTime).getTime()),"FINAL"===T.toUpperCase())r.searchingStartTime&&!r.searchingEndTime&&(r.searchingEndTime=Date.now()),r.message+=u;else if(x){let e=r.steps[x];if(e)if(e.tags.includes(T)){let t=e.tags.indexOf(T);t>=0&&(e.text[t]+=u)}else e.text.push(u),e.tags.push(T);else r.steps.push({text:[u],tags:[T],webSearchResults:[],xpostIds:[],xposts:[]})}}else R?r.thinkingTrace+=u:r.message+=u;if(r.liveThinkingStartTime&&!r.liveThinkingEndTime&&!R&&u&&(r.liveThinkingEndTime=Date.now()),I&&I.suggestions&&(r.suggestions=I.suggestions),B&&(r.followUpSuggestedMode=B,c(B)),C&&(C.followUpSuggestions&&(r.suggestions=C.followUpSuggestions),C.disclaimer&&d(C.disclaimer)),b){let{imageId:e,imageUrl:t}=b;if(e&&t){let o=null!=(s=r.streamingImageById)?s:{};b.progress&&(r.streamingImageById={...o,[e]:{...null!=(n=o[e])?n:{},[b.progress]:b}}),m.setOneImageIdByUrl(e,t)}}return P&&P.message&&d(P.message),M&&M.message&&d(M.message),k&&(r.progressReport=k),A&&(r.uiLayout={...null!=(o=r.uiLayout)?o:{},...A}),h&&(r={...r,...h,state:"closed"}),r},this.processSideBySide=e=>{let{responseChunk:t,toggledExperiment:s,conversationId:n,parentResponseId:o,userResponseId:r,modelName:i}=e,{sideBySideIndex:a}=t;if(null!=a&&!s)return N({conversationId:n,responseId:"streaming_in_progress_".concat(a,"_").concat(y()()),parentResponseId:r||o,sender:i})},this.processSoftStop=e=>{let{currentStreamResponse:t,responseChunk:s,startTimeMs:n}=e;return t.liveThinkingStartTime&&!t.liveThinkingEndTime&&(t.liveThinkingEndTime=Date.now()),t.generationTimeMs=Date.now()-n,t.state="closed",s.responseId&&(t.responseId=s.responseId),t.partial=!1,t},this.streamResponse=e=>{var t;let s,{message:i,metadata:d,parentResponseId:m,conversationId:p,modelName:u,fileAttachmentIds:v,webpageUrls:I,toolOverrides:w,customInstructions:S,customPersonality:b,deepsearchPreset:T,systemPromptName:x,isReasoning:P,imageEditUri:_,followUpType:A,enableRetries:j,onOptimisticUserResponse:U,onOptimisticModelResponse:L,onStart:D,onUserResponse:O,onStartExperiment:F,onCitations:q,onDisclaimer:G,onHasImage:V,onClose:W,onWke:Q,onError:$}=e,H=C.w.getState(),J=this.get(),K=(0,o.f)(),X=new AbortController;H.idsertAbortControllerById(X,p);let Z=R.x.getState().bestSubscription,Y=g.C$.getState().modelConfigOverrideByModel[u||"undefined"],ee=[],et=!i;et||(s=E({conversationId:p,responseId:"optimistic_query_".concat(y()()),parentResponseId:m,message:i,fileAttachments:v,webpageUrls:I,state:"optimistic"}),J.upsertResponse(s),U(s));let es=N({conversationId:p,responseId:"streaming_in_progress_".concat(y()()),parentResponseId:et?m:null==s?void 0:s.responseId,sender:u,state:"optimistic"},T,P);ee.push(es),J.upsertResponse(es),L(es);let en=(t={parentResponseId:m,message:i,metadata:{...d,modelConfigOverride:Y},modelName:u,fileAttachments:v,webpageUrls:I,toolOverrides:w,enableSideBySide:!K,systemPromptName:x,customInstructions:S,customPersonality:b,deepsearchPreset:T,isReasoning:P,imageEditUri:_,followUpType:A},{message:"",modelName:"",parentResponseId:"",systemPromptName:void 0,disableSearch:!1,imageAttachments:[],returnImageBytes:!1,returnRawGrokInXaiRequest:!1,fileAttachments:[],enableImageGeneration:!0,forceConcise:!1,enableImageStreaming:!0,enableSideBySide:!0,sendFinalMetadata:!0,imageGenerationCount:k,deepsearchPreset:"",isReasoning:!1,disableTextFollowUps:!0,followUpType:"",...t}),eo=!1,er=!1,ei=!1,ea=Date.now(),[el,ed]=B(),{log:ec,stop:em,resetTime:ep}=(0,a.Pp)("streamResponse",{type:"milliseconds_per_token",subscriptionTier:Z||"unknown",modelId:u,modelMode:(0,r.yv)({isReasoning:P,deepsearchPreset:T}),millisecondsPerTokenList:[]}),eu=(0,a.wl)("streamResponse",{type:"time_to_first_token",modelId:u,subscriptionTier:Z||"unknown",modelMode:(0,r.yv)({isReasoning:P,deepsearchPreset:T}),timeToFirstTokenMs:0},e=>{ee.forEach(t=>{t.liveTimeToFirstTokenMs=e})}),eh=(0,a.hl)("streamResponse",{type:"time_to_first_chunk",modelId:u,subscriptionTier:Z||"unknown",modelMode:(0,r.yv)({isReasoning:P,deepsearchPreset:T}),timeToFirstChunkMs:0},e=>{ee.forEach(t=>{t.liveTimeToFirstChunkMs=e})});return c.Pt.chatAddResponseRaw({conversationId:p,body:en}).then(async e=>{for await(let i of(s&&(s.state="streaming",ed(s)),(ee=ee.map(e=>({...e,state:"streaming"}))).forEach(ed),D(ee),(0,a.N8)("streamResponse",{type:"send_query_stream_start",subscriptionTier:Z||"unknown",modelId:u,modelMode:(0,r.yv)({isReasoning:P,deepsearchPreset:T})}),ep(),h(e.raw))){if(eh(),ec(),i.error){let e=Error(i.error.message);throw Q(e),e}if(!i.result)continue;let e=i.result,{userResponse:r,sideBySideIndex:l,isSoftStop:d,modelResponse:c}=e;if(null==r?void 0:r.error)throw s&&(s.state="error",s.error=r.error,ed(s)),(0,a.vV)("response-store:streamResponse:userResponseChunk",r.error),Error(r.error);if(null==c?void 0:c.error)throw(ee=ee.map(e=>({...e,state:"error",error:c.error}))).forEach(ed),(0,a.vV)("response-store:streamResponse:modelResponseChunk",c.error),Error(c.error);let h=this.processSideBySide({responseChunk:e,toggledExperiment:eo,conversationId:p,parentResponseId:m,userResponseId:null==s?void 0:s.responseId,modelName:u});if(h&&(eo=!0,ee.push(h),ed(h),F(ee.map(e=>e.responseId))),r){el(s={...r,conversationId:p,state:"closed"}),O(s),er=!0,(ee=ee.map(e=>({...e,parentResponseId:null==s?void 0:s.responseId}))).forEach(ed);continue}let g=null!=l?l:0,f=ee[g];if(!f)return;if(f=this.processResponseChunk({currentStreamResponse:f,responseChunk:e,onCitations:()=>q(f),onHasImage:V,onDisclaimer:G,onFollowUpSuggestedMode:e=>{var t;null===n.statsigClient||void 0===n.statsigClient||n.statsigClient.logEvent("follow_up_suggested_mode_button_shown",e.mode,{responseId:f.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})}}),(e.token||e.messageTag)&&eu(),el(f),ee[g]=f,d&&(f=this.processSoftStop({currentStreamResponse:f,responseChunk:e,startTimeMs:ea}),null===n.statsigClient||void 0===n.statsigClient||n.statsigClient.logEvent("generation_time_ms",f.generationTimeMs,{conversationId:p,responseId:f.responseId}),ed(f),ee.every(e=>"closed"===e.state))){var t,o;null===n.statsigClient||void 0===n.statsigClient||n.statsigClient.logEvent("finished_query",null==(t=ee[0])?void 0:t.responseId,{conversationId:p,toggledExperiment:eo.toString(),secondResponse:(null==(o=ee[1])?void 0:o.responseId)||"",isReasoning:P?P.toString():"",deepsearchPreset:T||""}),ee.forEach(ed),W(ee,ee.map(e=>e.responseId)),ei=!0}}if(er||et||(this.ensureUserResponseSaved({conversationId:p,message:i,userResponse:s,onUserResponse:O,forceUpsertResponse:ed}).then(z(ee)).then(e=>ee=e).catch((0,a.HX)("response-store:useResponseStore:streamResponse")),er=!0),!ei){let e=Error(f.CZ);(0,a.vV)("response-store:useResponseStore:streamResponse:closedStream",e)}(0,a.N8)("streamResponse",{type:"send_query_stream_success",subscriptionTier:Z||"unknown",modelId:u,modelMode:(0,r.yv)({isReasoning:P,deepsearchPreset:T})})}).catch(e=>{(0,a.vV)("response-store:streamCreateAndRespond",e),(0,l.GQ)(e)&&(0,a.N8)("streamResponse",{type:"send_query_stream_error",subscriptionTier:Z||"unknown",modelId:u,modelMode:(0,r.yv)({isReasoning:P,deepsearchPreset:T})});let t=$(e);if(j&&t)M(u,p,ee,P,T,D,q,G,V,W,Q).catch(e=>{throw(0,a.vV)("response-store:streamCreateAndRespond:handleStreamError",e),e});else throw(ee=ee.map(e=>({...e,state:"error",compoutedThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(ed),e}).finally(()=>{em()})},this.reconnectToResponse=e=>{let{inflightResponse:t,conversationId:s,modelName:o,parentResponseId:i,enableRetries:l,isReasoning:d,deepsearchPreset:m,onStart:p,onCitations:u,onDisclaimer:g,onHasImage:v,onClose:I,onWke:w,onError:S}=e,b=this.get(),T=C.w.getState(),x=new AbortController,P=R.x.getState().bestSubscription,_=!1;if(!t.responseId)throw Error("Inflight response missing responseId");let k=[],E={type:"milliseconds_per_token",subscriptionTier:P||"unknown",modelId:o,modelMode:(0,r.yv)({isReasoning:d,deepsearchPreset:m}),millisecondsPerTokenList:[]},{log:A,stop:z,resetTime:j}=(0,a.Pp)("reconnectToResponse",E);return c.Pt.chatReconnectResponseV2Raw({responseId:t.responseId}).then(async e=>{var c,y,S,C,R,M,E,z,U,L,D,O,F,q,G,V,W,Q;(0,a.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_start",subscriptionTier:P||"unknown",modelId:o,modelMode:(0,r.yv)({isReasoning:d,deepsearchPreset:m})}),j();let $=h(e.raw);A();let H=await $.next();if(!(null==(c=H.value)?void 0:c.result)||!(null==(C=H.value)||null==(S=C.result)||null==(y=S.response)?void 0:y.modelResponse))throw Error("No initial state received from reconnect");let{title:J,response:K}=H.value.result;if(J){let e=T.byId[s];T.upsertAndCacheConversation({...e,title:J.newTitle})}let X=N({...K.modelResponse,responseId:t.responseId,inflightResponseId:t.responseId,conversationId:s,parentResponseId:i,sender:o,state:"streaming",...t.createTime&&{createTime:t.createTime}});if(((null==(R=K.queryAction)?void 0:R.type)==="aurora"||(null==(M=K.queryAction)?void 0:M.type)==="flux")&&(X.hasImages=!0,v()),(null==(E=K.queryAction)?void 0:E.type)==="x"&&(X.hasSearches=!0),(null==(z=K.followUpSuggestions)?void 0:z.suggestions)&&(X.suggestions=K.followUpSuggestions.suggestions),K.followUpSuggestedMode&&(X.followUpSuggestedMode=K.followUpSuggestedMode),K.finalMetadata&&(K.finalMetadata.followUpSuggestions&&(X.suggestions=K.finalMetadata.followUpSuggestions),K.finalMetadata.disclaimer&&g(K.finalMetadata.disclaimer)),K.cachedImageGenerationResponse&&K.cachedImageGenerationResponse.imageUrl&&(X.generatedImageUrls=X.generatedImageUrls.concat([K.cachedImageGenerationResponse.imageUrl])),K.cardAttachment&&K.cardAttachment.jsonData&&(X.cardAttachmentsJson=X.cardAttachmentsJson.concat([K.cardAttachment.jsonData])),(null==(L=K.modelResponse)||null==(U=L.steps)?void 0:U.length)&&(X.searchingStartTime=new Date(X.createTime).getTime(),(null==(q=K.modelResponse)?void 0:q.message)&&(X.searchingEndTime=Date.now())),(null==(D=K.modelResponse)?void 0:D.thinkingTrace)&&(X.liveThinkingStartTime=new Date(X.createTime).getTime(),K.isThinking||X.liveThinkingEndTime||(X.liveThinkingEndTime=Date.now())),K.bannerMessage&&K.bannerMessage.message&&g(K.bannerMessage.message),K.disclaimer&&K.disclaimer.message&&g(K.disclaimer.message),k=[X],T.idsertAbortControllerById(x,s),b.upsertResponse(X),p(k),K.streamingImageGenerationResponse){let{imageId:e,imageUrl:t}=K.streamingImageGenerationResponse;if(e&&t){let s=null!=(G=X.streamingImageById)?G:{};K.streamingImageGenerationResponse.progress&&(X.streamingImageById={...s,[e]:{...null!=(V=s[e])?V:{},[K.streamingImageGenerationResponse.progress]:K.streamingImageGenerationResponse}}),b.setOneImageIdByUrl(e,t)}}((null==(O=X.webSearchResults)?void 0:O.length)||(null==(F=X.xposts)?void 0:F.length))&&u(X);let[Z,Y]=B(),ee=new Date(X.createTime).getTime();try{for await(let e of $){if(A(),e.error){let t=Error(e.error.message);throw w(t),t}if(!e.result)continue;let{title:t,response:o}=e.result;if(null==t?void 0:t.newTitle){let e=T.byId[s];T.upsertAndCacheConversation({...e,title:t.newTitle})}if(o){if(null==(W=o.modelResponse)?void 0:W.error)throw(0,a.vV)("response-store:reconnectToResponse:modelResponse",o.modelResponse.error),Error(o.modelResponse.error);X={...this.processResponseChunk({currentStreamResponse:X,responseChunk:o,onCitations:()=>u(X),onHasImage:v,onDisclaimer:g,onFollowUpSuggestedMode:e=>{var t;null===n.statsigClient||void 0===n.statsigClient||n.statsigClient.logEvent("follow_up_suggested_mode_button_shown",e.mode,{responseId:X.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})}}),parentResponseId:i},Z(X),k[0]=X,o.isSoftStop&&(X=this.processSoftStop({currentStreamResponse:X,responseChunk:o,startTimeMs:ee}),null===n.statsigClient||void 0===n.statsigClient||n.statsigClient.logEvent("generation_time_ms",X.generationTimeMs,{conversationId:s,responseId:X.responseId}),Y(X),k.every(e=>"closed"===e.state)&&(null===n.statsigClient||void 0===n.statsigClient||n.statsigClient.logEvent("finished_query",null==(Q=k[0])?void 0:Q.responseId,{conversationId:s,isReasoning:d?d.toString():"",deepsearchPreset:m||""}),k.forEach(Y),I(k,k.map(e=>e.responseId)),_=!0))}}if(!_){let e=Error(f.CZ);(0,a.vV)("response-store:useResponseStore:reconnectToResponse:closedStream",e)}(0,a.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_success",subscriptionTier:P||"unknown",modelId:o,modelMode:(0,r.yv)({isReasoning:d,deepsearchPreset:m})})}catch(e){throw l||(X={...X,state:"error",liveThinkingEndTime:X.liveThinkingStartTime&&!X.liveThinkingEndTime?Date.now():X.liveThinkingEndTime,searchingEndTime:X.searchingStartTime&&!X.searchingEndTime?Date.now():X.searchingEndTime},k[0]=X,Y(X)),e}}).catch(e=>{(0,a.vV)("response-store:reconnectToResponse",e),(0,a.N8)("reconnectToResponse",{type:"send_query_stream_reconnect_error",subscriptionTier:P||"unknown",modelId:o,modelMode:(0,r.yv)({isReasoning:d,deepsearchPreset:m})});let t=S(e);if(l&&t)M(o,s,k,d,m,p,u,g,v,I,w).catch(e=>{throw(0,a.vV)("response-store:reconnectToResponse:handleStreamError",e),e});else{if(0===k.length){let e=N({conversationId:s,responseId:"streaming_in_progress_".concat(y()()),parentResponseId:i,sender:o,state:"error"});k=[e],b.upsertResponse(e)}throw e}}).finally(()=>{T.removeAbortControllerById(s),z()})},this.streamCreateAndRespond=async e=>{var t;let{temporary:s,message:i,modelName:d,fileAttachmentIds:m,webpageUrls:p,systemPromptName:u,personaId:v,toolOverrides:I,isPreset:w,customInstructions:S,customPersonality:b,deepsearchPreset:T,isReasoning:x,imageEditUri:P,enableRetries:_,onOptimisticConversation:A,onOptimisticResponse:j,onStart:U,onConversation:L,onUserResponse:D,onStartExperiment:O,onCitations:F,onDisclaimer:q,onHasImage:G,onClose:V,onWke:W,onError:Q,workspaceIds:$,responseMetadata:H}=e,J=this.get(),K=C.w.getState(),X=(0,o.f)(),Z=R.x.getState().bestSubscription,Y="optimistic_conversation_".concat(y()()),ee=(0,C.b)({conversationId:Y,personaId:v,temporary:s});K.upsertAndCacheConversation(ee),A(ee);let et="optimistic_response_".concat(y()()),es=E({conversationId:ee.conversationId,responseId:et,message:i,fileAttachments:m,webpageUrls:p});J.upsertResponse(es),j(es);let en="streaming_in_progress_".concat(y()()),eo=N({conversationId:ee.conversationId,responseId:en,parentResponseId:es.responseId,sender:d},T,x),er=[eo];J.upsertResponse(eo);let ei=g.C$.getState().modelConfigOverrideByModel[d||"undefined"],ea=(t={temporary:s,message:i,modelName:d,fileAttachments:m,webpageUrls:p,systemPromptName:null!=u?u:v,toolOverrides:I,enableSideBySide:!X,customInstructions:S,customPersonality:b,deepsearchPreset:T,isReasoning:x,imageEditUri:P,workspaceIds:$,responseMetadata:{...H,modelConfigOverride:ei}},{systemPromptName:"",temporary:!1,message:"",modelName:"",fileAttachments:[],imageAttachments:[],disableSearch:!1,enableImageGeneration:!0,returnImageBytes:!1,returnRawGrokInXaiRequest:!1,enableImageStreaming:!0,imageGenerationCount:k,forceConcise:!1,enableSideBySide:!0,sendFinalMetadata:!0,disableTextFollowUps:!0,...t}),el=new AbortController;K.idsertAbortControllerById(el,Y);let ed=!1,ec=!1,em=!1,ep=Date.now(),[eu,eh]=B(),{log:eg,stop:ef,resetTime:ev}=(0,a.Pp)("streamCreateAndRespond",{type:"milliseconds_per_token",subscriptionTier:Z||"unknown",modelId:d,modelMode:(0,r.yv)({isReasoning:x,deepsearchPreset:T}),millisecondsPerTokenList:[]}),ey=(0,a.wl)("streamCreateAndRespond",{type:"time_to_first_token",modelId:d,subscriptionTier:Z||"unknown",modelMode:(0,r.yv)({isReasoning:x,deepsearchPreset:T}),timeToFirstTokenMs:0},e=>{er.forEach(t=>{t.liveTimeToFirstTokenMs=e})}),eI=(0,a.hl)("streamCreateAndRespond",{type:"time_to_first_chunk",modelId:d,subscriptionTier:Z||"unknown",modelMode:(0,r.yv)({isReasoning:x,deepsearchPreset:T}),timeToFirstChunkMs:0},e=>{er.forEach(t=>{t.liveTimeToFirstChunkMs=e})});return c.Pt.chatCreateConversationAndRespondRaw({body:ea}).then(async e=>{for await(let o of(es={...es,state:"streaming"},er=er.map(e=>({...e,state:"streaming"})),eh(es),er.forEach(eh),U(er),(0,a.N8)("streamCreateAndRespond",{type:"send_query_stream_start",subscriptionTier:Z||"unknown",modelId:d,modelMode:(0,r.yv)({isReasoning:x,deepsearchPreset:T})}),ev(),h(e.raw))){if(eI(),eg(),o.error){let e=Error(o.error.message);throw W(e),e}if(!o.result)continue;let{response:e,conversation:r,title:i}=o.result;if(r){K.removeConversation(ee.conversationId),ee={...ee,isNew:!0,fromPreset:w,state:"closed",systemPromptName:"",...r},K.upsertAndCacheConversation(ee),K.idsertAbortControllerById(el,ee.conversationId),es={...es,conversationId:ee.conversationId},er=er.map(e=>({...e,parentResponseId:es.responseId,conversationId:ee.conversationId})),eu(es),er.forEach(eh),L(ee);continue}if((null==i?void 0:i.newTitle)&&(ee={...ee,title:i.newTitle},K.upsertAndCacheConversation(ee)),e){let{userResponse:o,sideBySideIndex:r,isSoftStop:i,modelResponse:l}=e;if(null==o?void 0:o.error)throw eh(es={...es,...o,state:"error"}),(0,a.vV)("response-store:useResponseStore:streamResponse:userResponseChunk",o.error),Error(o.error);if(null==l?void 0:l.error)throw(er=er.map(e=>({...e,...l,state:"error"}))).forEach(eh),(0,a.vV)("response-store:useResponseStore:streamResponse:modelResponseChunk",l.error),Error(l.error);let c=this.processSideBySide({responseChunk:e,toggledExperiment:ed,conversationId:ee.conversationId,parentResponseId:es.responseId,modelName:d});if(c&&(ed=!0,er.push(c),eh(c),O(er.map(e=>e.responseId))),o){eu(es={...es,...o,conversationId:ee.conversationId,state:"closed"}),D(es),ec=!0,(er=er.map(e=>({...e,parentResponseId:null==es?void 0:es.responseId}))).forEach(eh);continue}let m=null!=r?r:0,p=er[m];if(!p)continue;if(p=this.processResponseChunk({currentStreamResponse:p,responseChunk:e,onCitations:()=>F(p),onHasImage:G,onDisclaimer:q,onFollowUpSuggestedMode:e=>{var t;null===n.statsigClient||void 0===n.statsigClient||n.statsigClient.logEvent("follow_up_suggested_mode_button_shown",e.mode,{responseId:p.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})}}),(e.token||e.messageTag)&&ey(),eu(p),er[m]=p,i&&(p=this.processSoftStop({currentStreamResponse:p,responseChunk:e,startTimeMs:ep}),null===n.statsigClient||void 0===n.statsigClient||n.statsigClient.logEvent("generation_time_ms",p.generationTimeMs,{conversationId:ee.conversationId,responseId:p.responseId}),eh(p),er.every(e=>"closed"===e.state))){var t,s;null===n.statsigClient||void 0===n.statsigClient||n.statsigClient.logEvent("finished_query",null==(t=er[0])?void 0:t.responseId,{conversationId:ee.conversationId,toggledExperiment:ed.toString(),secondResponse:(null==(s=er[1])?void 0:s.responseId)||"",isReasoning:x?x.toString():"",deepsearchPreset:T||""}),er.forEach(eh),V(er),em=!0}}}if(ec||(this.ensureUserResponseSaved({conversationId:ee.conversationId,message:i,userResponse:es,onUserResponse:D,forceUpsertResponse:eh}).then(z(er)).then(e=>er=e).catch((0,a.HX)("response-store:useResponseStore:streamCreateAndRespond")),ec=!0),!em){let e=Error(f.CZ);(0,a.vV)("response-store:useResponseStore:streamCreateAndRespond:closedStream",e)}(0,a.N8)("streamCreateAndRespond",{type:"send_query_stream_success",subscriptionTier:Z||"unknown",modelId:d,modelMode:(0,r.yv)({isReasoning:x,deepsearchPreset:T})})}).catch(e=>{(0,a.vV)("response-store:useResponseStore:streamCreateAndRespond",e),(0,l.GQ)(e)&&(0,a.N8)("streamCreateAndRespond",{type:"send_query_stream_error",subscriptionTier:Z||"unknown",modelId:d,modelMode:(0,r.yv)({isReasoning:x,deepsearchPreset:T})});let t=Q(e);if(_&&t)M(d,ee.conversationId,er,x,T,U,F,q,G,V,W).catch(e=>{throw(0,a.vV)("response-store:useResponseStore:streamCreateAndRespond:handleStreamError",e),e});else throw(er=er.map(e=>({...e,state:"error",liveThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(eh),V(er),e}).finally(()=>{ef()})},this.ensureUserResponseSaved=e=>{let{conversationId:t,message:s,userResponse:n,onUserResponse:o,forceUpsertResponse:r}=e;return this.get().addUserResponse(t,s).then(e=>(r(e),o(e),e)).catch(()=>{if(!n)return;let e={...n,state:"error"};return r(e),e})},this.abortStream=async(e,t)=>{let s=this.get(),n=C.w.getState(),o=s.byId[t];if(!o.state||!["streaming","error","reconnecting"].includes(o.state))return Promise.resolve(t);let r=n.abortControllerById[e];return r&&(r.abort(),n.removeAbortControllerById(e)),c.Pt.chatStopConversationInflightResponses({conversationId:e}).then(()=>{let t={...o,responseId:o.inflightResponseId,conversationId:e,state:"closed",partial:!0,liveThinkingEndTime:o.liveThinkingStartTime&&!o.liveThinkingEndTime?Date.now():o.liveThinkingEndTime,searchingEndTime:o.searchingStartTime&&!o.searchingEndTime?Date.now():o.searchingEndTime};return s.upsertResponse(t),t.responseId}).catch(e=>{let t={...o,state:"error",liveThinkingEndTime:o.liveThinkingStartTime&&!o.liveThinkingEndTime?Date.now():o.liveThinkingEndTime,searchingEndTime:o.searchingStartTime&&!o.searchingEndTime?Date.now():o.searchingEndTime};throw s.upsertResponse(t),e})},this.addUserResponse=(e,t,s)=>c.Pt.chatAddUserResponse({conversationId:e,body:{message:t,parentResponseId:s}}).then(t=>{let s=this.get(),n={...t,conversationId:e};return s.upsertResponse(n),n})}}async function M(e,t,s,o,i,d,m,p,u,g,f){let v=_.getState(),y=C.w.getState(),I=R.x.getState().bestSubscription,w=s.map(e=>({...e,state:"reconnecting"}));w.forEach(v.upsertResponse);let S=e=>new Promise(t=>setTimeout(t,e));if(t.startsWith("optimistic_conversation_"))return void(w=w.map(e=>({...e,state:"error"}))).forEach(v.upsertResponse);let b={type:"milliseconds_per_token",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,r.yv)({isReasoning:o,deepsearchPreset:i}),millisecondsPerTokenList:[]},{log:T,stop:x,resetTime:P}=(0,a.Pp)("handleStreamError",b);(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_start",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,r.yv)({isReasoning:o,deepsearchPreset:i})});for(let s=1;s<=10;s++){try{let s=await v.fetchListInflightResponses(t,!0);if(s.length>0&&s[0].responseId&&w[0].parentResponseId){await c.Pt.chatReconnectResponseV2Raw({responseId:s[0].responseId}).then(async l=>{var c,S,b,C,R,x,M,_,k,E,A,z,j,U,L,D,O,F;(0,a.N8)("handleStreamError",{type:"send_query_stream_reconnect_start",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,r.yv)({isReasoning:o,deepsearchPreset:i})}),P();let q=h(l.raw);T();let G=await q.next();if(!(null==(c=G.value)?void 0:c.result)||!(null==(C=G.value)||null==(b=C.result)||null==(S=b.response)?void 0:S.modelResponse))throw Error("No initial state received from reconnect");let{title:V,response:W}=G.value.result;if(V){let e=y.byId[t];y.upsertAndCacheConversation({...e,title:V.newTitle})}let Q=N({...W.modelResponse,conversationId:t,responseId:w[0].responseId,parentResponseId:w[0].parentResponseId,sender:w[0].sender,state:"streaming",...s[0].createTime&&{createTime:s[0].createTime}});if(((null==(R=W.queryAction)?void 0:R.type)==="aurora"||(null==(x=W.queryAction)?void 0:x.type)==="flux")&&(Q.hasImages=!0,u()),(null==(M=W.queryAction)?void 0:M.type)==="x"&&(Q.hasSearches=!0),(null==(_=W.followUpSuggestions)?void 0:_.suggestions)&&(Q.suggestions=W.followUpSuggestions.suggestions),W.followUpSuggestedMode&&(Q.followUpSuggestedMode=W.followUpSuggestedMode),W.finalMetadata&&(W.finalMetadata.followUpSuggestions&&(Q.suggestions=W.finalMetadata.followUpSuggestions),W.finalMetadata.disclaimer&&p(W.finalMetadata.disclaimer)),W.cachedImageGenerationResponse&&W.cachedImageGenerationResponse.imageUrl&&(Q.generatedImageUrls=Q.generatedImageUrls.concat([W.cachedImageGenerationResponse.imageUrl])),W.cardAttachment&&W.cardAttachment.jsonData&&(Q.cardAttachmentsJson=Q.cardAttachmentsJson.concat([W.cardAttachment.jsonData])),(null==(E=W.modelResponse)||null==(k=E.steps)?void 0:k.length)&&(Q.searchingStartTime=new Date(Q.createTime).getTime(),(null==(U=W.modelResponse)?void 0:U.message)&&(Q.searchingEndTime=Date.now())),W.bannerMessage&&W.bannerMessage.message&&p(W.bannerMessage.message),W.disclaimer&&W.disclaimer.message&&p(W.disclaimer.message),(null==(A=W.modelResponse)?void 0:A.thinkingTrace)&&(Q.liveThinkingStartTime=new Date(Q.createTime).getTime(),W.isThinking||Q.liveThinkingEndTime||(Q.liveThinkingEndTime=Date.now())),w=[Q],v.upsertResponse(Q),d(w),W.streamingImageGenerationResponse){let{imageId:e,imageUrl:t}=W.streamingImageGenerationResponse;if(e&&t){let s=null!=(L=Q.streamingImageById)?L:{};W.streamingImageGenerationResponse.progress&&(Q.streamingImageById={...s,[e]:{...null!=(D=s[e])?D:{},[W.streamingImageGenerationResponse.progress]:W.streamingImageGenerationResponse}}),v.setOneImageIdByUrl(e,t)}}((null==(z=Q.webSearchResults)?void 0:z.length)||(null==(j=Q.xposts)?void 0:j.length))&&m(Q);let[$,H]=B(),J=new Date(Q.createTime).getTime();for await(let e of q){if(T(),e.error){let t=Error(e.error.message);throw f(t),t}if(!e.result)continue;let{title:s,response:r}=e.result;if(null==s?void 0:s.newTitle){let e=y.byId[t];y.upsertAndCacheConversation({...e,title:s.newTitle})}if(r){if(null==(O=r.modelResponse)?void 0:O.error)throw(0,a.vV)("response-store:handleStreamError:modelResponse",r.modelResponse.error),Error(r.modelResponse.error);Q={...v.processResponseChunk({currentStreamResponse:Q,responseChunk:r,onCitations:()=>m(Q),onHasImage:u,onDisclaimer:p,onFollowUpSuggestedMode:e=>{var t;null===n.statsigClient||void 0===n.statsigClient||n.statsigClient.logEvent("follow_up_suggested_mode_button_shown",e.mode,{responseId:Q.responseId,followUpSuggestedMode:null!=(t=e.mode)?t:"UNKNOWN"})}}),parentResponseId:w[0].parentResponseId},$(Q),w[0]=Q,r.isSoftStop&&(Q=v.processSoftStop({currentStreamResponse:Q,responseChunk:r,startTimeMs:J}),null===n.statsigClient||void 0===n.statsigClient||n.statsigClient.logEvent("generation_time_ms",Q.generationTimeMs,{conversationId:t,responseId:Q.responseId}),H(Q),w.every(e=>"closed"===e.state)&&(null===n.statsigClient||void 0===n.statsigClient||n.statsigClient.logEvent("finished_query",null==(F=w[0])?void 0:F.responseId,{conversationId:t,isReasoning:o?o.toString():"",deepsearchPreset:i||""}),w.forEach(H),g(w,w.map(e=>e.responseId))))}}("streaming"===Q.state||"reconnecting"===Q.state)&&(Q={...Q,state:"closed",liveThinkingEndTime:Q.liveThinkingStartTime&&!Q.liveThinkingEndTime?Date.now():Q.liveThinkingEndTime,searchingEndTime:Q.searchingStartTime&&!Q.searchingEndTime?Date.now():Q.searchingEndTime},w[0]=Q,H(Q)),g(w,w.map(e=>e.responseId)),(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_success",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,r.yv)({isReasoning:o,deepsearchPreset:i})}),(0,a.N8)("handleStreamError",{type:"send_query_stream_reconnect_success",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,r.yv)({isReasoning:o,deepsearchPreset:i})})});break}(w=w.map(e=>({...e,state:"error",liveThinkingEndTime:e.liveThinkingStartTime&&!e.liveThinkingEndTime?Date.now():e.liveThinkingEndTime,searchingEndTime:e.searchingStartTime&&!e.searchingEndTime?Date.now():e.searchingEndTime}))).forEach(v.upsertResponse),(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_fail",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,r.yv)({isReasoning:o,deepsearchPreset:i})});break}catch(t){if(x(),(0,a.vV)("response-store:handleStreamError:retryError",t),(0,l.GQ)(t)&&((0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_error",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,r.yv)({isReasoning:o,deepsearchPreset:i})}),(0,a.N8)("handleStreamError",{type:"send_query_stream_reconnect_error",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,r.yv)({isReasoning:o,deepsearchPreset:i})})),10===s)throw(0,a.N8)("handleStreamError",{type:"send_query_stream_auto_reconnect_fail",subscriptionTier:I||"unknown",modelId:e,modelMode:(0,r.yv)({isReasoning:o,deepsearchPreset:i})}),(w=w.map(e=>({...e,state:"error"}))).forEach(v.upsertResponse),t;await S(2e3),(w=w.map(e=>({...e,state:"reconnecting"}))).forEach(v.upsertResponse)}x()}}let _=(0,d.y$)(P);(0,d.lB)(_,"byId","byConversationId",(e,t)=>{let s=Object.values(e),n=_.getState().byConversationId,o=new Set(w()(s).filter(e=>e!==t[e.responseId]||!!e.state&&"closed"!==e.state).map(e=>e.conversationId).value()),r=s.filter(e=>o.has(e.conversationId)),i=S.A(e=>e.conversationId,r);return{...n,...w().pick(i,[...o.values()])}}),(0,d.lB)(_,"byId","nodesByConversationId",e=>{let t=_.getState().nodesByConversationId,s=!1,n={};for(let o in e){let r=e[o],i=r.conversationId,a=t[i]||[],l=a.find(e=>e.responseId===o);l?"streaming"===r.state&&l.parentResponseId!==r.parentResponseId&&(s=!0,n[i]=[...a,{...l,parentResponseId:r.parentResponseId}]):(s||(s=!0,n={...t}),n[i]?n[i]===a&&(n[i]=[...a]):n[i]=[...a],n[i].push({responseId:o,parentResponseId:r.parentResponseId,sender:r.sender}))}return s?n:t});let k=2;function E(e){return{sender:"human",createTime:new Date().toISOString(),manual:!1,partial:!0,shared:!1,isControl:!1,query:"",queryType:"",thinkingTrace:"",webSearchResults:[],xpostIds:[],xposts:[],generatedImageUrls:[],imageAttachments:[],imageEditUris:[],fileAttachments:[],cardAttachmentsJson:[],fileUris:[],fileAttachmentsMetadata:[],state:"optimistic",parentResponseId:"",steps:[],imageEditUri:"",error:"",mediaTypes:[],webpageUrls:[],metadata:{},uiLayout:{reasoningUiLayout:"UNSPECIFIED"},...e}}function N(e,t,s){let n="default"===t?Date.now():void 0,o=s?Date.now():void 0;return{message:"",createTime:new Date().toISOString(),manual:!1,partial:!0,shared:!1,isControl:!1,query:"",queryType:"",thinkingTrace:"",webSearchResults:[],xpostIds:[],xposts:[],generatedImageUrls:[],imageAttachments:[],imageEditUris:[],fileAttachments:[],cardAttachmentsJson:[],fileUris:[],fileAttachmentsMetadata:[],state:"streaming",steps:[],imageEditUri:"",error:"",mediaTypes:[],webpageUrls:[],metadata:{},deepsearchPreset:t,generatedImageHeight:void 0,generatedImageWidth:void 0,...e,liveThinkingStartTime:o,searchingStartTime:n,uiLayout:{reasoningUiLayout:"UNSPECIFIED"}}}function B(){let e,t={};return[s=>{if(!e){_.getState().upsertResponse(s),e=setTimeout(()=>{let s=Object.values(t);t={},s.length&&_.getState().appendResponses(s),e=void 0},30);return}t[s.responseId]=s},s=>{s&&(t[s.responseId]=s),clearTimeout(e);let n=Object.values(t);t={},n.length&&_.getState().appendResponses(n),e=void 0}]}function A(e){return e.liveThinkingStartTime||e.searchingStartTime||e.thinkingStartTime}function z(e){return t=>(t&&e.forEach(e=>{e.parentResponseId=t.responseId}),e)}},44347:(e,t,s)=>{s.d(t,{C$:()=>f});var n=s(65258),o=s(11492),r=s(31352),i=s.n(r),a=s(96892),l=s.n(a),d=s(6132),c=s(4890),m=s(17823);d.z.object({promptMap:d.z.object({toolUseFc:d.z.string().nullish(),noToolUse:d.z.string().nullish(),toolUseSummarizer:d.z.string().nullish()}).nullish(),modelMap:d.z.object({noToolUse:d.z.string().nullish(),toolUse:d.z.string().nullish(),toolUseSummarizer:d.z.string().nullish()}).nullish(),useSingleModelEverything:d.z.boolean().nullish()}),d.z.object({autoOpenSearchResults:d.z.boolean(),displayUserMessageMarkdown:d.z.boolean(),showFollowUpSuggestions:d.z.boolean(),animateQueryPlaceholder:d.z.boolean(),autoWrapLongLinesCode:d.z.boolean(),browserNotificationsEnabled:d.z.boolean(),selectedSystemPromptId:d.z.string().optional(),showConversationPreviews:d.z.boolean().optional(),hideArtifacts:d.z.boolean().optional(),autoDetectWebpageAttachments:d.z.boolean(),showActiveTabs:d.z.boolean().optional(),disableTypeahead:d.z.boolean().optional(),disableAutoScroll:d.z.boolean().optional()});let p={autoOpenSearchResults:!1,displayUserMessageMarkdown:!1,showFollowUpSuggestions:!0,animateQueryPlaceholder:!0,autoWrapLongLinesCode:!1,browserNotificationsEnabled:!1,selectedSystemPromptId:void 0,showConversationPreviews:!0,hideArtifacts:!1,autoDetectWebpageAttachments:!1,showActiveTabs:!0,disableTypeahead:!1,disableAutoScroll:!1},u={isIncognito:!1,userSettingsPromise:void 0,userSettings:{excludeFromTraining:!1,allowXPersonalization:!0,preferences:p,enableMemory:!0},selectedLanguage:void 0,showAgeVerification:!1,ageVerificationCallback:void 0,modelConfigOverride:void 0,modelConfigOverrideByModel:{}},h={excludeFromTraining:!0,allowXPersonalization:!1,preferences:p,enableMemory:!1};class g{constructor(e,t){this.set=e,this.get=t,this.isIncognito=u.isIncognito,this.userSettingsPromise=u.userSettingsPromise,this.userSettings=u.userSettings,this.selectedLanguage=u.selectedLanguage,this.showAgeVerification=u.showAgeVerification,this.ageVerificationCallback=u.ageVerificationCallback,this.modelConfigOverride=u.modelConfigOverride,this.modelConfigOverrideByModel=u.modelConfigOverrideByModel,this.setIsIncognito=(0,n.kp)(this.set,"isIncognito"),this.setUserSettingsPromise=(0,n.kp)(this.set,"userSettingsPromise"),this.setUserSettings=(0,n.kp)(this.set,"userSettings"),this.setSelectedLanguage=(0,n.kp)(this.set,"selectedLanguage"),this.setShowAgeVerification=(0,n.kp)(this.set,"showAgeVerification"),this.setAgeVerificationCallback=(0,n.kp)(this.set,"setAgeVerificationCallback"),this.setModelConfigOverrideByModel=(0,n.kp)(this.set,"modelConfigOverrideByModel"),this.initializeGdprUserSettings=()=>o.aK.settingsGetUserSettings().then(e=>{let t=this.get();void 0===e.excludeFromTraining||void 0===e.enableMemory?t.fetchSetUserSettings(h).catch(console.error):t.setUserSettings(y(e,t.userSettings))}),this.initializeEnterpriseUserSettings=()=>o.aK.settingsGetUserSettings().then(e=>{let t=this.get();e.excludeFromTraining?t.setUserSettings(y(e,t.userSettings)):t.fetchSetUserSettings(h).catch(console.error)}),this.fetchGetUserSettings=()=>{let e=this.get();if(e.userSettingsPromise)return e.userSettingsPromise;let t=o.aK.settingsGetUserSettings().then(t=>y(t,e.userSettings));return e.setUserSettingsPromise(t),t.then(e.setUserSettings).catch(console.error),t},this.fetchSetUserSettings=e=>{let t=this.get();t.setUserSettings({...t.userSettings,...e});let s=o.aK.settingsSetUserSettings({body:e}).then(e=>y(e,this.get().userSettings));return t.setUserSettingsPromise(s),s.then(t.setUserSettings).catch(e=>{console.error(e)}),s},this.fetchSetPreference=(e,t)=>{let s=this.get();return s.fetchSetUserSettings({...s.userSettings,preferences:{...s.userSettings.preferences,[e]:t}})}}}let f=(0,c.v)()((0,m.eh)((0,m.Zr)((e,t)=>new g(e,t),{name:"settings-store",partialize:e=>({modelConfigOverrideByModel:e.modelConfigOverrideByModel}),version:2})));function v(e,t){return d.z.object({autoOpenSearchResults:d.z.boolean().catch(e.autoOpenSearchResults),displayUserMessageMarkdown:d.z.boolean().catch(e.displayUserMessageMarkdown),showFollowUpSuggestions:d.z.boolean().catch(e.showFollowUpSuggestions),animateQueryPlaceholder:d.z.boolean().catch(e.animateQueryPlaceholder),autoWrapLongLinesCode:d.z.boolean().catch(e.autoWrapLongLinesCode),browserNotificationsEnabled:d.z.boolean().catch(e.browserNotificationsEnabled),selectedSystemPromptId:d.z.string().optional().catch(e.selectedSystemPromptId),showConversationPreviews:d.z.boolean().optional().catch(e.showConversationPreviews),hideArtifacts:d.z.boolean().optional().catch(e.hideArtifacts),autoDetectWebpageAttachments:d.z.boolean().catch(e.autoDetectWebpageAttachments),showActiveTabs:d.z.boolean().optional().catch(e.showActiveTabs),disableTypeahead:d.z.boolean().optional().catch(e.disableTypeahead),disableAutoScroll:d.z.boolean().optional().catch(e.disableAutoScroll)}).catch(e).parse(t)}function y(e,t){let s=l()(e,i());return{...t,...s,preferences:v(t.preferences,e.preferences)}}(0,n.CP)(f,"userSettings","user-settings",u.userSettings,function(e){return e&&"object"==typeof e?{excludeFromTraining:u.userSettings.excludeFromTraining,allowXPersonalization:u.userSettings.allowXPersonalization,preferences:{...v(p,e.userSettings),autoOpenSearchResults:!1,disableTypeahead:!1},enableMemory:u.userSettings.enableMemory}:u.userSettings})},44845:(e,t,s)=>{s.d(t,{Ku:()=>r,TM:()=>o,ot:()=>a,yv:()=>i});var n=s(6132);let o=n.z.union([n.z.literal("none"),n.z.literal("unknown"),n.z.literal("deepsearch"),n.z.literal("deepersearch"),n.z.literal("think")]);function r(e){return"deepersearch"===e?"deeper":"deepsearch"===e?"default":void 0}function i(e){let{isReasoning:t,deepsearchPreset:s}=e;return t?"think":"deeper"===s?"deepersearch":"default"===s?"deepsearch":s?"unknown":"none"}function a(e){return"deepersearch"===e?"DEEPERSEARCH":"deepsearch"===e?"DEEPSEARCH":"think"===e?"REASONING":"DEFAULT"}},48992:(e,t,s)=>{s.d(t,{Cg:()=>l,Mb:()=>d,Wm:()=>function e(t,s){let n=t[s];if(!n)return s;let o=n[n.length-1];return o&&o.responseId?e(t,o.responseId):s},d7:()=>i,m$:()=>a,zp:()=>c});var n=s(38541),o=s.n(n),r=s(17703);function i(e,t,s){let n=o().keyBy(t,"responseId"),r=n[e];if(!r)return[];let i=[r],a=r.parentResponseId;for(;a&&(!s||i.length<s);){let e=n[a];if(!e)break;i.push(e),a=e.parentResponseId}return i}function a(e,t){let s;for(let n of e)if(t.find(e=>e.responseId===n.responseId))s=n;else break;return s}function l(e,t){let s=[],n=e,o=new Set;for(;n;){if(o.has(n.responseId||"")){(0,r.vV)("conversation-utils:getAncestorIds","Cycle detected in response hierarchy: ".concat(n.responseId));break}o.add(n.responseId||""),s.unshift(n.responseId||"");let e=n.parentResponseId;if(!e)break;n=t[e]}return s}function d(e){let t=new Set(e.map(e=>e.parentResponseId)),s=e.filter(e=>!t.has(e.responseId));if(0!==s.length)return o().maxBy(s,e=>e.createTime)}function c(e,t,s){if(!s)return!1;for(let n of i(s,t))if(n.responseId&&!e.some(e=>e.responseId===n.responseId))return!0;return!1}},56096:(e,t,s)=>{s.d(t,{x:()=>r});var n=s(65258);class o{constructor(e,t){this.set=e,this.get=t}}let r=(0,n.y$)(o)},58192:(e,t,s)=>{s.d(t,{Sk:()=>n,Wl:()=>r,fG:()=>i,oQ:()=>o});let n="grok-3",o="Grok 3",r="Grok 3",i="Grok 2"},65258:(e,t,s)=>{s.d(t,{BC:()=>I,CP:()=>S,L$:()=>u,TF:()=>h,WQ:()=>m,dX:()=>p,el:()=>g,gN:()=>v,kp:()=>c,lB:()=>w,oQ:()=>y,q5:()=>f,y$:()=>b});var n=s(85431),o=s(3275),r=s(74995),i=s(53915),a=s(46815),l=s(4890),d=s(17823);function c(e,t){return s=>{e(e=>({...e,[t]:s}))}}function m(e,t){return s=>{e(e=>({...e,[t]:[...e[t]||[],s]}))}}function p(e,t,s){return()=>{e(e=>({...e,[t]:s}))}}function u(e,t){return()=>{e(e=>({...e,[t]:!e[t]}))}}function h(e,t){return s=>{e(e=>({...e,[t]:n.A([s],e[t])}))}}function g(e,t,s){return n=>{e(e=>({...e,[t]:{...e[t],...o.A(r.A(s),[n])}}))}}function f(e,t){return(s,n)=>{e(e=>({...e,[t]:{...e[t],[n]:s}}))}}function v(e,t){return(s,n)=>{e(e=>({...e,[t]:{...e[t],[n]:[...e[t][n]||[],s]}}))}}function y(e,t,s){return(n,o)=>{let r=!1;return e(e=>{var i;return{...e,[t]:{...e[t],[n]:null==(i=e[t][n])?void 0:i.filter(e=>{let t=e[s]!==o;return t||(r=!0),t})}}}),r}}function I(e,t,s){return n=>{e(e=>({...e,[t]:{...e[t],...o.A(r.A(s),n)}}))}}function w(e,t,s,n){let{subscribe:o,setState:l}=e;return o(r.A(t),(e,t)=>{l(i.A(a.A(s),n(e,t)))},{fireImmediately:!0})}function S(e,t,s,n,o){let{subscribe:l,setState:d}=e;try{let e=localStorage.getItem(s);if(null!=e){let s=JSON.parse(e);if(o){let e=o(s);d(i.A(a.A(t),e))}else d(i.A(a.A(t),s))}}catch(e){localStorage.setItem(s,JSON.stringify(n))}l(r.A(t),e=>{localStorage.setItem(s,JSON.stringify(e))})}function b(e){return(0,l.v)()((0,d.eh)((t,s)=>new e(t,s)))}},68332:(e,t,s)=>{s.d(t,{o:()=>d});var n=s(92539),o=s(39116),r=s(12110),i=s(88382);let a=[new r.w("/chat/:chatId"),new r.w("/chat"),new r.w("/")],l=new r.w("/share/:shareLinkId");function d(){let e=(0,o.useRouter)(),t=(0,o.usePathname)(),s=(0,i.useMemo)(()=>!!t&&a.some(e=>e.test(t)),[t]),r=(0,i.useMemo)(()=>!!t&&l.test(t),[t]),d=(0,i.useMemo)(()=>{if(r){var e;return{shareLinkId:null==(e=l.test(t))?void 0:e.shareLinkId}}},[r,t]);return{isChatPage:s,isSharePage:r,pageData:d,routeToConversation:(0,i.useCallback)((t,o)=>{let r=n.aP.getState();r.setConversationId(t),r.setSidePanelContent(void 0),!o&&(t?s||e.push("/chat/".concat(t)):e.push("/"))},[e,t]),signInWithReturnTo:(0,i.useCallback)((s,n)=>{let o=new URLSearchParams({q:s||"",reasoningMode:n||"none"}).toString(),r=o?"".concat(t,"?").concat(o):t,i=r?new URLSearchParams({return_to:r}).toString():void 0;e.push("/sign-in".concat(i?"?".concat(i):""))},[e,t])}}},70888:(e,t,s)=>{s.d(t,{x:()=>c});var n=s(17703),o=s(65258),r=s(11492),i=s(14908),a=s(86530).hp;let l={listByConversationId:{},fileMetaPromiseById:{},fileMetaById:{},attachListByConversationId:{}};class d{constructor(e,t){this.set=e,this.get=t,this.listByConversationId=l.listByConversationId,this.fileMetaPromiseById=l.fileMetaPromiseById,this.fileMetaById=l.fileMetaById,this.attachListByConversationId=l.attachListByConversationId,this.lisertByConversationId=(0,o.gN)(this.set,"listByConversationId"),this.removeByConversationId=(0,o.TF)(this.set,"listByConversationId"),this.delistByConversationId=(0,o.oQ)(this.set,"listByConversationId","file"),this.upsertFileMetadata=(0,o.el)(this.set,"fileMetaById","fileMetadataId"),this.idsertFileMetadataPromise=(0,o.q5)(this.set,"fileMetaPromiseById"),this.lisertAttachByConversationId=(0,o.gN)(this.set,"attachListByConversationId"),this.removeAttachByConversationId=(0,o.TF)(this.set,"attachListByConversationId"),this.delistAttachByConversationId=(0,o.oQ)(this.set,"attachListByConversationId","assetId"),this.fetchUploadFile=(e,t)=>{let s=this.get(),o=e.arrayBuffer().then(t=>r.Pt.chatUploadFile({body:{fileName:e.name,fileMimeType:e.type,content:a.from(t).toString("base64")}}).then(e=>e).catch(e=>{if(e.message.includes("OUT_OF_RANGE"))throw Error("File was too large.");throw e})),i={file:e,metadataPromise:o};return s.lisertByConversationId(i,t),o.then(n=>{s.delistByConversationId(t,e)&&s.lisertByConversationId({...i,metadata:n},t)}).catch(o=>{s.delistByConversationId(t,e)&&(s.lisertByConversationId({...i,metadata:o},t),(0,n.vV)("fetchUploadFile",o))}),i},this.fetchFileMetadata=e=>{let t=this.get();if(e in t.fileMetaById)return Promise.resolve(t.fileMetaById[e]);if(e in t.fileMetaPromiseById)return t.fileMetaPromiseById[e];let s=r.Pt.chatGetFileMetadata({fileMetadataId:e}).then(e=>e);return t.idsertFileMetadataPromise(s,e),s.then(t.upsertFileMetadata),s},this.fetchAttachThirdPartyFile=(e,t,s,o,a)=>{let l=this.get(),d=r.Pt.chatUploadFile({body:{fileName:e,fileMimeType:t,fileSource:s,thirdPartyFileId:o}}).then(e=>e).catch(e=>{if(e.message.includes("OUT_OF_RANGE"))throw Error("File was too large.");throw e}),c=new File([o],e),m={file:c,metadataPromise:d};return l.lisertByConversationId(m,a),d.then(e=>{l.delistByConversationId(a,c)&&l.lisertByConversationId({...m,metadata:e},a)}).catch(e=>{l.delistByConversationId(a,c)&&(l.lisertByConversationId({...m,metadata:e},a),(0,n.vV)("fetchAttachThirdPartyFile",e)),e.message&&i.oR.error(e.message)}),m}}}let c=(0,o.y$)(d)},73354:(e,t,s)=>{s.d(t,{Oj5:()=>g,Qtr:()=>c,VAL:()=>p,id:()=>h});var n=s(79342),o=s(40409),r=s(37953);function i(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,o.$)(t))}var a=s(88382);let l=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,n.jsx)("path",{d:"m10.828 12 4.95 4.95-1.414 1.415L8 12l6.364-6.364 1.414 1.414z"})}),d=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 33 33",...e,children:(0,n.jsx)("path",{fill:"currentColor",d:"m13.237 21.04 11.082-8.19c.543-.4 1.32-.244 1.578.38 1.363 3.288.754 7.241-1.957 9.955-2.71 2.714-6.482 3.31-9.93 1.954l-3.765 1.745c5.401 3.697 11.96 2.782 16.059-1.324 3.251-3.255 4.258-7.692 3.317-11.693l.008.009c-1.365-5.878.336-8.227 3.82-13.031q.123-.17.247-.345l-4.585 4.59v-.014L13.234 21.044M10.95 23.031c-3.877-3.707-3.208-9.446.1-12.755 2.446-2.449 6.454-3.448 9.952-1.979L24.76 6.56c-.677-.49-1.545-1.017-2.54-1.387A12.465 12.465 0 0 0 8.675 7.901c-3.519 3.523-4.625 8.94-2.725 13.561 1.42 3.454-.907 5.898-3.251 8.364-.83.874-1.664 1.749-2.335 2.674l10.583-9.466"})}),c=e=>{let{"aria-label":t,className:s,color:o,size:r="medium"}=e,a="number"==typeof r?{height:r,width:r}:void 0;return(0,n.jsx)("span",{className:i("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===r,"w-5 h-5":"small"===r,"w-6 h-6":"medium"===r,"w-8 h-8":"large"===r,"w-full h-full":"fill"===r},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(d,{"aria-hidden":!t,"aria-label":t,className:i({"w-4 h-4":"x-small"===r,"w-5 h-5":"small"===r,"w-6 h-6":"medium"===r,"w-8 h-8":"large"===r,"w-full h-full":"fill"===r}),focusable:"false",style:{fill:"currentColor",...a}})})};c.displayName="GrokLogoIcon";let m=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeWidth:1.5,viewBox:"0 0 24 24",...e,children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.712 4.33a9 9 0 0 1 1.652 1.306c.51.51.944 1.064 1.306 1.652M16.712 4.33l-3.448 4.138m3.448-4.138a9.01 9.01 0 0 0-9.424 0M19.67 7.288l-4.138 3.448m4.138-3.448a9.01 9.01 0 0 1 0 9.424m-4.138-5.976a3.7 3.7 0 0 0-.88-1.388 3.7 3.7 0 0 0-1.388-.88m2.268 2.268a3.77 3.77 0 0 1 0 2.528m-2.268-4.796a3.77 3.77 0 0 0-2.528 0m4.796 4.796a3.75 3.75 0 0 1-.88 1.388 3.7 3.7 0 0 1-1.388.88m2.268-2.268 4.138 3.448m0 0a9 9 0 0 1-1.306 1.652c-.51.51-1.064.944-1.652 1.306m0 0-3.448-4.138m3.448 4.138a9.01 9.01 0 0 1-9.424 0m5.976-4.138a3.77 3.77 0 0 1-2.528 0m0 0a3.7 3.7 0 0 1-1.388-.88 3.7 3.7 0 0 1-.88-1.388m2.268 2.268L7.288 19.67m0 0a9 9 0 0 1-1.652-1.306 9 9 0 0 1-1.306-1.652m0 0 4.138-3.448M4.33 16.712a9.01 9.01 0 0 1 0-9.424m4.138 5.976a3.77 3.77 0 0 1 0-2.528m0 0c.181-.506.475-.982.88-1.388a3.7 3.7 0 0 1 1.388-.88m-2.268 2.268L4.33 7.288m6.406 1.18L7.288 4.33m0 0a9 9 0 0 0-1.652 1.306A9 9 0 0 0 4.33 7.288"})}),p=e=>{let{"aria-label":t,className:s,color:o,size:r="medium"}=e,a="number"==typeof r?{height:r,width:r}:void 0;return(0,n.jsx)("span",{className:i("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===r,"w-5 h-5":"small"===r,"w-6 h-6":"medium"===r,"w-8 h-8":"large"===r,"w-full h-full":"fill"===r},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(m,{"aria-hidden":!t,"aria-label":t,className:i({"w-4 h-4":"x-small"===r,"w-5 h-5":"small"===r,"w-6 h-6":"medium"===r,"w-8 h-8":"large"===r,"w-full h-full":"fill"===r}),focusable:"false",style:{fill:"currentColor",...a}})})};p.displayName="SupportIcon";let u=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",...e,children:(0,n.jsx)("path",{d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10m0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16m-1-5h2v2h-2zm0-8h2v6h-2z"})}),h=e=>{let{"aria-label":t,className:s,color:o,size:r="medium"}=e,a="number"==typeof r?{height:r,width:r}:void 0;return(0,n.jsx)("span",{className:i("inline-flex items-center justify-center p-0 m-0",{"w-4 h-4":"x-small"===r,"w-5 h-5":"small"===r,"w-6 h-6":"medium"===r,"w-8 h-8":"large"===r,"w-full h-full":"fill"===r},s),"data-namespace":"@xai/icons","data-slot":"icon",style:{color:o,...a},children:(0,n.jsx)(u,{"aria-hidden":!t,"aria-label":t,className:i({"w-4 h-4":"x-small"===r,"w-5 h-5":"small"===r,"w-6 h-6":"medium"===r,"w-8 h-8":"large"===r,"w-full h-full":"fill"===r}),focusable:"false",style:{fill:"currentColor",...a}})})};h.displayName="WarningIcon";let g=e=>{let{"aria-label":t,className:s,color:o,disabled:r,size:d="medium",type:c="button",...m}=e,p=(0,a.useRef)(null),u=null!=r?!!r:!t,h="number"==typeof d?{height:d,width:d}:void 0;return(0,n.jsx)("button",{...m,type:c,"aria-disabled":r,"aria-hidden":u,"aria-label":t,className:i("inline-flex items-center justify-center border-none bg-transparent hover:bg-muted/50 rounded-full p-0 m-0 appearance-none disabled:opacity-30",{"w-4 h-4":"x-small"===d,"w-5 h-5":"small"===d,"w-6 h-6":"medium"===d,"w-8 h-8":"large"===d,"w-full h-full":"fill"===d},s),"data-namespace":"@xai/icons","data-slot":"icon",disabled:r,ref:p,style:{color:o,...h},children:(0,n.jsx)(l,{className:i({"w-[1.125rem] h-[1.125rem]":"medium"===d,"w-[1.375rem] h-[1.375rem]":"large"===d,"w-3.5 h-3.5":"x-small"===d,"w-4 h-4":"small"===d,"w-full h-full":"fill"===d}),focusable:"false",style:{fill:"currentColor",...h}})})};g.displayName="ArrowLeftIconButton"},92539:(e,t,s)=>{s.d(t,{aP:()=>z});var n=s(78436),o=s(58192),r=s(41320),i=s(44845);function a(e){let t=!1;return()=>{t||(e(),t=!0)}}var l=s(17703),d=s(33960),c=s(65258),m=s(36936),p=s(29938),u=s(43893),h=s(44347),g=s(31643),f=s(38541),v=s.n(f),y=s(12110),I=s(14908),w=s(6132),S=s(4890),b=s(17823),C=s(79342);let R=[1];var T=s(11492),x=s(98100),P=s(73354),M=s(88382),_=s(65146);let k=e=>{let{modelName:t,reasoningMode:s,waitTimeSeconds:n}=e,{t:o}=(0,_.Bd)("chat"),{modelById:r}=(0,x.GB)(),i=(0,M.useMemo)(()=>{var e;return(null==(e=r[t])?void 0:e.name)||t},[r,t]),a=(0,M.useMemo)(()=>{let e=Math.floor(n/3600),t=Math.floor(n%3600/60);return e>0&&t>0?"".concat(o("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e})," ").concat(o("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})):e>0?o("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e}):o("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})},[n]),l=(0,M.useMemo)(()=>"DEEPSEARCH"===s?o("Rate Limit Reached.description-deepsearch","Query limit reached for {{modelName}} with DeepSearch. Limit refreshes in {{time}}.",{modelName:i,time:a}):"DEEPERSEARCH"===s?o("Rate Limit Reached.description-deepersearch","Query limit reached for {{modelName}} with DeeperSearch. Limit refreshes in {{time}}.",{modelName:i,time:a}):"REASONING"===s?o("Rate Limit Reached.description-reasoning","Query limit reached for {{modelName}} with Think. Limit refreshes in {{time}}.",{modelName:i,time:a}):o("Rate Limit Reached.description","Query limit reached for {{modelName}}. Limit refreshes in {{time}}.",{modelName:i,time:a}),[a,i,o,s]);return(0,C.jsxs)("div",{className:"flex items-center gap-2",children:[(0,C.jsx)(P.id,{className:"size-5"}),(0,C.jsx)("div",{className:"font-semibold text-xs",children:l})]})},E=e=>{let{modelName:t,reasoningMode:s,remainingQueries:n,windowSizeSeconds:o}=e,{t:r}=(0,_.Bd)("chat"),{modelById:i}=(0,x.GB)(),a=(0,M.useMemo)(()=>{var e;return(null==(e=i[t])?void 0:e.name)||t},[i,t]),l=(0,M.useMemo)(()=>{let e=Math.floor(o/3600),t=Math.floor(o%3600/60);return e>0&&t>0?"".concat(r("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e})," ").concat(r("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})):e>0?r("time.hours",{defaultValue_one:"{{count}} hour",defaultValue_other:"{{count}} hours",count:e}):r("time.minutes",{count:t,defaultValue_one:"{{count}} minutes",defaultValue_other:"{{count}} minutes"})},[o]),d=(0,M.useMemo)(()=>"DEEPSEARCH"===s?r("Remaining Queries.description-deepsearch",{modelName:a,count:n,time:l,defaultValue_one:"One query left for {{modelName}} with DeepSearch. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with DeepSearch. Limit resets every {{time}}."}):"DEEPERSEARCH"===s?r("Remaining Queries.description-deepersearch",{modelName:a,count:n,time:l,defaultValue_one:"One query left for {{modelName}} with DeeperSearch. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with DeeperSearch. Limit resets every {{time}}."}):"REASONING"===s?r("Remaining Queries.description-reasoning",{modelName:a,count:n,time:l,defaultValue_one:"One query left for {{modelName}} with Think. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}} with Think. Limit resets every {{time}}."}):r("Remaining Queries.description",{modelName:a,count:n,time:l,defaultValue_one:"One query left for {{modelName}}. Limit resets every {{time}}.",defaultValue_other:"You have {{count}} remaining queries for {{modelName}}. Limit resets every {{time}}."}),[n,a,l,r,s]);return(0,C.jsxs)("div",{className:"flex items-center gap-2",children:[(0,C.jsx)(P.id,{className:"size-5"}),(0,C.jsx)("div",{className:"text-xs font-semibold",children:d})]})};function N(e){T.tW.rateLimitsGetRateLimits({body:e}).then(t=>{void 0!==t.remainingQueries&&R.includes(t.remainingQueries)?I.oR.info((0,C.jsx)(E,{reasoningMode:e.requestKind,modelName:e.modelName,remainingQueries:t.remainingQueries,windowSizeSeconds:t.windowSizeSeconds||0}),{duration:7e3}):0===t.remainingQueries&&t.waitTimeSeconds&&I.oR.info((0,C.jsx)(k,{reasoningMode:e.requestKind,modelName:e.modelName,waitTimeSeconds:t.waitTimeSeconds}),{duration:7e3})}).catch(e=>{(0,l.vV)("chat-page-store:checkRateLimits",e)})}function B(e){I.oR.info(function(e,t){let s=e.trim().replace(/^[^a-zA-Z0-9]+|[^a-zA-Z0-9]+$/g,"");return s.length>200?s.slice(0,200)+"...":s}(e,200),{duration:7e3})}w.z.union([w.z.literal("auto"),w.z.literal("image"),w.z.literal("search"),w.z.literal("modelOnly"),w.z.literal("noSearch")]);class A{constructor(e,t){this.set=e,this.get=t,this.activeModelId=o.Sk,this.isRateLimited=!1,this.isThinkingRateLimited=!1,this.isDeepSearchRateLimited=!1,this.isUnauthenticated=!1,this.hasDismissedDisclaimer=!1,this.outputMode="auto",this.reasoningMode="none",this.usingExperiment=!1,this.experiments=[],this.streamingExperimentsIds=[],this.queryBarExpanded=!1,this.isTypingDebounce=!1,this.selectedPersonalityId=void 0,this.customPersonality=void 0,this.queryByConversationId={},this.chatPageLoaded=!1,this.isDeeperSearchSelected=!1,this.setConversationId=(0,c.kp)(this.set,"conversationId"),this.setOptimisticConversationId=(0,c.kp)(this.set,"optimisticConversationId"),this.setLastMessageId=(0,c.kp)(this.set,"lastMessageId"),this.setSidePanelContent=(0,c.kp)(this.set,"sidePanelContent"),this.setStreamedMessageId=(0,c.kp)(this.set,"streamedMessageId"),this.setActiveModelId=(0,c.kp)(this.set,"activeModelId"),this.setSelectedSystemPromptId=(0,c.kp)(this.set,"selectedSystemPromptId"),this.setIsRateLimited=(0,c.kp)(this.set,"isRateLimited"),this.setIsUnauthenticated=(0,c.kp)(this.set,"isUnauthenticated"),this.setHasDismissedDisclaimer=(0,c.kp)(this.set,"hasDismissedDisclaimer"),this.setOptimisticMessageId=(0,c.kp)(this.set,"optimisticMessageId"),this.setOutputMode=(0,c.kp)(this.set,"outputMode"),this.setReasoningMode=(0,c.kp)(this.set,"reasoningMode"),this.setChatPageLoaded=(0,c.kp)(this.set,"chatPageLoaded"),this.setDefaultAnonModelId=(0,c.kp)(this.set,"defaultAnonModelId"),this.setDefaultFreeModelId=(0,c.kp)(this.set,"defaultFreeModelId"),this.setDefaultProModelId=(0,c.kp)(this.set,"defaultProModelId"),this.setUsingExperiment=e=>{this.removeAllExperiments(),this.removeAllStreamingExperiments(),this.set(t=>({...t,usingExperiment:e}))},this.removeAllExperiments=(0,c.dX)(this.set,"experiments",[]),this.setExperiments=(0,c.kp)(this.set,"experiments"),this.addExperiment=(0,c.WQ)(this.set,"experiments"),this.removeExperiment=e=>{this.set(t=>{let s=[...t.experiments];return s.splice(e,1),{...t,experiments:s}})},this.setStreamingExperimentsIds=(0,c.kp)(this.set,"streamingExperimentsIds"),this.addStreamingExperimentId=(0,c.WQ)(this.set,"streamingExperimentsIds"),this.removeAllStreamingExperiments=(0,c.dX)(this.set,"streamingExperimentsIds",[]),this.setSelectedPersonalityId=(0,c.kp)(this.set,"selectedPersonalityId"),this.setCustomPersonality=(0,c.kp)(this.set,"customPersonality"),this.idsetQueryByConversationId=(0,c.q5)(this.set,"queryByConversationId"),this.setQueryBarExpanded=e=>this.set({queryBarExpanded:e}),this.setIsTypingDebounce=e=>this.set({isTypingDebounce:e}),this.setIsDeeperSearchSelected=(0,c.kp)(this.set,"isDeeperSearchSelected"),this.isErrorRetryable=e=>{let t=(0,d.G1)(e);return 429===t?(this.setIsRateLimited(!0),!1):401===t?(this.setIsUnauthenticated(!0),!1):!(t&&t>=400&&t<500||e.message.includes("Failed to respond")||e.message.includes(g.CZ)||e.message.includes(g.S3))},this.establishNewConversation=async e=>{let{temporary:t,message:s,fileAttachmentIds:n,webpageUrls:o,toolOverrides:l,isPreset:d,persona:c,enableRetries:m,imageEditUri:g,workspaceIds:f,responseMetadata:y}=e,I=this.get(),w=u.A3.getState(),S=h.C$.getState(),b=p.jN.getState(),C=v().get(b.byId,S.userSettings.preferences.selectedSystemPromptId||""),R=I.activeModelId,T=U(void 0,I.reasoningMode,R),x=void 0,P=(null==C?void 0:C.prompt)||I.customPersonality,M=!1;return new Promise((e,p)=>{w.streamCreateAndRespond({temporary:t,message:s,modelName:R,fileAttachmentIds:n,webpageUrls:o,systemPromptName:null==c?void 0:c.systemPromptName,personaId:null==c?void 0:c.personaId,toolOverrides:null!=l?l:j(I.outputMode,T),isPreset:d,customInstructions:x,customPersonality:P,deepsearchPreset:(0,i.Ku)(T),isReasoning:"think"===T,imageEditUri:g,enableRetries:m,workspaceIds:f,responseMetadata:y,onOptimisticConversation:e=>{let{conversationId:t}=e;I.setOptimisticConversationId(t)},onOptimisticResponse:e=>{let{responseId:t}=e;I.setOptimisticMessageId(t)},onStart:e=>{var t;I.setStreamedMessageId(null==(t=e[0])?void 0:t.responseId)},onConversation:t=>{I.setConversationId(t.conversationId),I.setOptimisticConversationId(void 0),M=!0,e(t)},onUserResponse:e=>{I.setLastMessageId(e.responseId),I.setOptimisticMessageId(e.responseId)},onStartExperiment:e=>{I.setUsingExperiment(!0),e.forEach(e=>{I.addStreamingExperimentId(e),I.addExperiment({})})},onCitations:e=>{if((!window||!(window.innerWidth<r.Dy))&&S.userSettings.preferences.autoOpenSearchResults){if(e.webSearchResults)return void I.setSidePanelContent({type:"webSearchResults",data:{webSearchResults:e.webSearchResults}});if(e.xposts)return void I.setSidePanelContent({type:"xPosts",data:e.xposts})}},onDisclaimer:c?()=>{}:B,onHasImage:a(()=>S.setShowAgeVerification(!0)),onClose:e=>{e.length>1&&(I.setExperiments(e),I.setStreamingExperimentsIds(e.map(e=>e.responseId)));let t=v().first(e);t&&this.get().lastMessageId===t.parentResponseId&&(I.setLastMessageId(t.responseId),I.setStreamedMessageId(t.responseId)),N({modelName:R,requestKind:(0,i.ot)(T)}),M?I.setOptimisticConversationId(void 0):p(Error("Not resolved by close"))},onWke:e=>{"RateLimitError"===e.name&&I.setIsRateLimited(!0),p(e)},onError:this.isErrorRetryable}).catch(e=>{p(e)})})},this.sendResponse=async e=>{let{message:t,parentResponseId:s,conversationId:n,fileAttachmentIds:o,webpageUrls:l,toolOverrides:d,setOpimisticUserResponse:c,setUserResponse:m,onOptimisticUserResponse:g,onError:f,imageEditUri:y,persona:I,enableRetries:w,metadata:S,followUpType:b,reasoningMode:C}=e,R=this.get(),T=u.A3.getState(),x=h.C$.getState(),P=p.jN.getState(),M=v().get(P.byId,x.userSettings.preferences.selectedSystemPromptId||""),_=R.activeModelId,k=void 0,E=(null==M?void 0:M.prompt)||R.customPersonality;R.setUsingExperiment(!1),R.setLastMessageId(s);let A=U(C,R.reasoningMode,_);return new Promise((e,p)=>{T.streamResponse({message:t,metadata:S,parentResponseId:s,conversationId:n,modelName:_,systemPromptName:null==I?void 0:I.systemPromptName,fileAttachmentIds:o,webpageUrls:l,toolOverrides:{...j(R.outputMode,A),...null!=d?d:{}},customInstructions:k,customPersonality:E,deepsearchPreset:(0,i.Ku)(A),isReasoning:"think"===A,imageEditUri:y,enableRetries:w,followUpType:b,onOptimisticUserResponse:e=>{c&&(R.setOptimisticMessageId(e.responseId),null==g||g(e))},onOptimisticModelResponse:e=>{R.setStreamedMessageId(e.responseId)},onStart:e=>{var t;R.setStreamedMessageId(null==(t=e[0])?void 0:t.responseId)},onUserResponse:e=>{m&&(R.setLastMessageId(e.responseId),R.setOptimisticMessageId(e.responseId))},onStartExperiment:e=>{R.setUsingExperiment(!0),e.forEach(e=>{R.addStreamingExperimentId(e),R.addExperiment({})})},onCitations:e=>{if((!window||!(window.innerWidth<r.Dy))&&x.userSettings.preferences.autoOpenSearchResults){if(e.webSearchResults)return void R.setSidePanelContent({type:"webSearchResults",data:{webSearchResults:e.webSearchResults}});if(e.xposts)return void R.setSidePanelContent({type:"xPosts",data:e.xposts})}},onDisclaimer:I?()=>{}:B,onHasImage:a(()=>x.setShowAgeVerification(!0)),onClose:t=>{t.length>1&&(R.setExperiments(t),R.setStreamingExperimentsIds(t.map(e=>e.responseId)));let s=v().first(t);if(s&&this.get().lastMessageId===s.parentResponseId&&(R.setLastMessageId(s.responseId),R.setStreamedMessageId(s.responseId)),t.length&&t.every(e=>"closed"===e.state))e(t);else{let e=Error("Responses missing, errored, or not closed");null==f||f(e),p(e)}N({modelName:_,requestKind:(0,i.ot)(A)})},onWke:e=>{"RateLimitError"===e.name&&R.setIsRateLimited(!0),null==f||f(e),p(e)},onError:this.isErrorRetryable}).catch(e=>{null==f||f(e),p(e)})})},this.reconnectToInflightResponses=async(e,t)=>{let s=this.get(),n=u.A3.getState(),o=h.C$.getState(),d=s.activeModelId;try{let c=await n.fetchListInflightResponses(e);if(!c.length)return;let m=v().maxBy(c,e=>new Date(e.createTime?e.createTime:0));if(!m)return;if(!m.responseId)return void(0,l.vV)("chat-page-store:reconnectToInflightResponses","Inflight response missing response id");if(!m.parentResponseId)return void(0,l.vV)("chat-page-store:reconnectToInflightResponses","Inflight response missing parent response id:");s.setLastMessageId(m.parentResponseId),await n.reconnectToResponse({inflightResponse:m,conversationId:e,modelName:d,parentResponseId:m.parentResponseId,enableRetries:t,isReasoning:"think"===s.reasoningMode,deepsearchPreset:(0,i.Ku)(s.reasoningMode),onStart:e=>{let t=e[0];t&&s.setStreamedMessageId(t.responseId)},onCitations:e=>{if((!window||!(window.innerWidth<r.Dy))&&o.userSettings.preferences.autoOpenSearchResults){if(e.webSearchResults)return void s.setSidePanelContent({type:"webSearchResults",data:{webSearchResults:e.webSearchResults}});if(e.xposts)return void s.setSidePanelContent({type:"xPosts",data:e.xposts})}},onDisclaimer:B,onHasImage:a(()=>o.setShowAgeVerification(!0)),onClose:(e,t)=>{e.length>1&&(s.setExperiments(e),s.setStreamingExperimentsIds(t));let n=v().first(e);n&&(s.setLastMessageId(n.responseId),s.setStreamedMessageId(void 0)),N({modelName:d,requestKind:(0,i.ot)(s.reasoningMode)})},onWke:e=>{"RateLimitError"===e.name&&s.setIsRateLimited(!0),console.error("Error reconnecting to response:",e)},onError:this.isErrorRetryable})}catch(e){console.error("Error checking for inflight responses:",e)}}}}let z=(0,S.v)()((0,b.eh)((0,b.Zr)((e,t)=>new A(e,t),{name:"chat-preferences",partialize:e=>({outputMode:e.outputMode,activeModelId:e.activeModelId,selectedPersonalityId:e.selectedPersonalityId,customPersonality:e.customPersonality,defaultAnonModelId:e.defaultAnonModelId,defaultFreeModelId:e.defaultFreeModelId,defaultProModelId:e.defaultProModelId}),version:1})));function j(e,t){switch(t){case"deepsearch":case"deepersearch":return{imageGen:void 0,webSearch:void 0,xSearch:void 0,xMediaSearch:void 0,trendsSearch:void 0,xPostAnalyze:void 0}}switch(e){case"modelOnly":return{imageGen:!1,webSearch:!1,xSearch:!1,xMediaSearch:!1,trendsSearch:!1,xPostAnalyze:!1};case"noSearch":return{imageGen:void 0,webSearch:!1,xSearch:!1,xMediaSearch:!1,trendsSearch:!1,xPostAnalyze:!1};default:return{imageGen:void 0,webSearch:void 0,xSearch:void 0,xMediaSearch:void 0,trendsSearch:void 0,xPostAnalyze:void 0}}}function U(e,t,s){var n,o;if(e)return e;let r=m.V.getState().modelById[s];return((null==r||null==(n=r.tags)?void 0:n.includes("think"))||"think"!==t)&&((null==r||null==(o=r.tags)?void 0:o.includes("deepsearch"))||"deepsearch"!==t&&"deepersearch"!==t)?t:"none"}(0,c.lB)(z,"conversationId","optimisticConversationId",()=>void 0),(0,c.lB)(z,"conversationId","isRateLimited",()=>!1),(0,c.lB)(z,"conversationId","isUnauthenticated",()=>!1),(0,c.lB)(z,"conversationId","hasDismissedDisclaimer",()=>!1),(0,c.lB)(z,"conversationId","usingExperiment",()=>!1),(0,c.lB)(z,"conversationId","experiments",()=>[]),(0,c.lB)(z,"conversationId","streamingExperimentsIds",()=>[]),(0,c.lB)(z,"activeModelId","isRateLimited",()=>!1),(0,c.lB)(z,"reasoningMode","isRateLimited",()=>!1),!function(e){let t=new y.w("/chat/:chatId"),s=t.test(window.location.pathname);e.setState({conversationId:s?s.chatId:void 0}),window.addEventListener("popstate",()=>{let s=t.test(window.location.pathname);e.setState({conversationId:s?s.chatId:void 0})}),e.subscribe((e,s)=>{if(e.conversationId===s.conversationId)return;let o=window.location.pathname,r=t.test(window.location.pathname);if("/"!==o&&!r)return;let i=new URLSearchParams(window.location.search);i.delete("q"),i.delete("reasoningMode");let a=i.toString(),l=a?"?".concat(a):"",d=h.C$.getState(),c=null===n.sessionStoreState||void 0===n.sessionStoreState?void 0:n.sessionStoreState.getState();if(!(o.split("/")[1]||"").includes(".")){if(e.conversationId&&!d.isIncognito&&(null==c?void 0:c.user)){let s=t.build({chatId:e.conversationId});if(o!==s){let e="".concat(s).concat(l);window.history.pushState({...window.history.state,as:e,url:e},"",e)}}else if("/"!==o){let e="/".concat(l);window.history.pushState({...window.history.state,as:e,url:e},"",e)}}})}(z)},98100:(e,t,s)=>{s.d(t,{$E:()=>y,QG:()=>I,GB:()=>w});var n=s(92539),o=s(58192),r=s(6132);let i=r.z.object({modelId:r.z.string(),name:r.z.string().optional(),description:r.z.string().optional(),tags:r.z.array(r.z.string()).optional(),badgeText:r.z.string().optional()});r.z.object({models:r.z.array(i).optional().default([]),defaultFreeModel:r.z.string().optional(),defaultProModel:r.z.string().optional(),unavailableModels:r.z.array(i).optional().default([]),defaultAnonModel:r.z.string().optional()});let a=e=>["get-models",e];var l=s(11492),d=s(70888),c=s(31643),m=s(61683),p=s(38541),u=s.n(p),h=s(74995),g=s(3275),f=s(88382),v=s(75500);function y(){let e=(0,v.h)();return(0,f.useMemo)(()=>e.FORCE_SIGN_IN_MODELS.value.forceSignInModels&&Array.isArray(e.FORCE_SIGN_IN_MODELS.value.forceSignInModels)?e.FORCE_SIGN_IN_MODELS.value.forceSignInModels:[],[e.FORCE_SIGN_IN_MODELS.value])}function I(e){var t,s;let o=(0,d.x)(h.A("listByConversationId")),r=(0,d.x)(h.A("attachListByConversationId")),i=(0,n.aP)(h.A("conversationId"))||"no_conversation_id",a=(0,n.aP)(h.A("reasoningMode")),l="deepsearch"==a||"deepersearch"==a,c="think"==a,m=o[i],p=r[i],u=((null==m?void 0:m.length)||0)+((null==p?void 0:p.length)||0),g=null==e||null==(t=e.tags)?void 0:t.includes("no_attachments_for_think"),v=null==e||null==(s=e.tags)?void 0:s.includes("no_attachments_for_deepsearch"),y=!!(u&&g),I=!!(u&&v);return{isAttachDisabled:(0,f.useMemo)(()=>!!g&&!!c||!!v&&!!l,[l,c,g,v]),isThinkDisabled:y,isDeepsearchDisabled:I,isThinkSelected:c,isDeepsearchSelected:l}}function w(){var e,t,s,n;let r=m.Ay.language,d=(0,v.h)(),{data:p,isPending:y}=(0,c.IT)({queryKey:a(r),queryFn:async()=>{var e;return{models:((e=await l.FI.modelsGetModels({body:{locale:r}})).models||[]).map(e=>i.safeParse(e)).filter(e=>e.success).map(e=>e.data).sort((e,t)=>e.name===o.Wl?-1:t.name===o.Wl||e.name===o.fG?1:t.name===o.fG?-1:0),unavailableModels:(e.unavailableModels||[]).map(e=>i.safeParse(e)).filter(e=>e.success).map(e=>e.data),defaultAnonModelId:e.defaultAnonModel,defaultFreeModelId:e.defaultFreeModel,defaultProModelId:e.defaultProModel}},staleTime:3e5}),I=(0,f.useMemo)(()=>{var e;if(!p)return[];let t=new Set(null==(e=S.safeParse(d.HIDE_MODELS.value).data)?void 0:e.hideModels);return u().sortBy(p.models.filter(e=>!t.has(e.modelId)),"name")},[p,d.HIDE_MODELS]),w=(0,f.useMemo)(()=>I?g.A(h.A("modelId"),I):{},[I]);return{models:I,unavailableModels:null!=(e=null==p?void 0:p.unavailableModels)?e:[],defaultAnonModelId:null!=(t=null==p?void 0:p.defaultAnonModelId)?t:o.Sk,defaultFreeModelId:null!=(s=null==p?void 0:p.defaultFreeModelId)?s:o.Sk,defaultProModelId:null!=(n=null==p?void 0:p.defaultProModelId)?n:o.Sk,modelById:w,isPending:y}}let S=r.z.object({hideModels:r.z.array(r.z.string())})}}]);